<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工单详情</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .priority-urgent { 
            background-color: #ff4d4f; 
            color: white;
        }
        .priority-high { 
            background-color: #faad14; 
            color: white;
        }
        .priority-medium { 
            background-color: #1890ff; 
            color: white;
        }
        .priority-low { 
            background-color: #52c41a; 
            color: white;
        }
        
        .status-pending { background-color: #faad14; color: white; }
        .status-processing { background-color: #1890ff; color: white; }
        .status-resolved { background-color: #52c41a; color: white; }
        .status-closed { background-color: #8c8c8c; color: white; }
        
        .timeline-item {
            position: relative;
            padding-left: 24px;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 8px;
            width: 8px;
            height: 8px;
            background-color: #1890ff;
            border-radius: 50%;
        }
        
        .timeline-item::after {
            content: '';
            position: absolute;
            left: 11px;
            top: 16px;
            width: 2px;
            height: calc(100% - 8px);
            background-color: #e8e8e8;
        }
        
        .timeline-item:last-child::after {
            display: none;
        }
        
        .attachment-item {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            margin-right: 8px;
            margin-bottom: 8px;
        }
        
        .material-chip {
            background: #e6f7ff;
            color: #1890ff;
            border: 1px solid #91d5ff;
            border-radius: 16px;
            padding: 4px 12px;
            font-size: 12px;
            display: inline-flex;
            align-items: center;
            margin-right: 8px;
            margin-bottom: 4px;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 1000;
        }
        
        .modal-content {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            max-width: 400px;
            margin: 0 auto;
            animation: slide-up 0.3s ease-out;
        }
        
        @keyframes slide-up {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .material-input-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            border: 2px solid transparent;
        }
        
        .material-input-item.selected {
            border-color: #1890ff;
            background: #f0f9ff;
        }
        
        .quick-material-btn {
            background: #e6f7ff;
            border: 1px dashed #91d5ff;
            color: #1890ff;
            border-radius: 8px;
            padding: 8px 12px;
            margin: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quick-material-btn:hover {
            background: #bae7ff;
            border-color: #40a9ff;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 导航栏 -->
    <div class="bg-white px-4 py-3 shadow-sm">
        <div class="flex items-center justify-between">
            <button class="p-2 -ml-2">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </button>
            <h1 class="text-lg font-semibold text-gray-800">#TK001215</h1>
            <button class="p-2 -mr-2">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- 工单头部信息 -->
    <div class="bg-white px-4 py-4 border-b">
        <div class="flex items-start justify-between mb-3">
            <div class="flex items-center">
                <span class="priority-urgent px-2 py-1 rounded text-sm mr-2">紧急</span>
                <span class="status-processing px-2 py-1 rounded text-sm">处理中</span>
            </div>
            <div class="text-right text-sm text-gray-600">
                <div>📅 2024-12-13 09:30</div>
                <div>⏰ 2小时前</div>
            </div>
        </div>
        
        <h2 class="text-xl font-semibold text-gray-800 mb-3">电脑无法开机</h2>
        
        <div class="space-y-2 text-sm">
            <div class="flex items-center">
                <span class="w-6 text-center">👤</span>
                <span class="ml-2 text-gray-700">张三 | 财务部</span>
            </div>
            <div class="flex items-center">
                <span class="w-6 text-center">📞</span>
                <span class="ml-2 text-gray-700">138****8000</span>
            </div>
            <div class="flex items-center">
                <span class="w-6 text-center">📍</span>
                <span class="ml-2 text-gray-700">行政楼4楼405室</span>
            </div>
            <div class="flex items-center">
                <span class="w-6 text-center">👨‍🔧</span>
                <span class="ml-2 text-gray-700">分配给: 李工程师</span>
            </div>
        </div>
    </div>

    <!-- 问题描述 -->
    <div class="bg-white px-4 py-4 mb-2">
        <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">📝</span>
            问题描述
        </h3>
        <div class="bg-gray-50 p-3 rounded-lg text-gray-700 leading-relaxed">
            昨天下班前电脑还正常使用，今天早上来上班按开机键没有任何反应，电源指示灯也不亮。检查了电源线连接正常，但是主机完全没有响应。希望能尽快处理，因为有重要的财务报表需要完成。
        </div>
    </div>

    <!-- 附件 -->
    <div class="bg-white px-4 py-4 mb-2">
        <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">📎</span>
            附件 (3)
        </h3>
        <div class="flex flex-wrap">
            <div class="attachment-item">
                <span class="text-blue-500 mr-2">🖼️</span>
                <span class="text-sm text-gray-700">电脑现状.jpg</span>
            </div>
            <div class="attachment-item">
                <span class="text-green-500 mr-2">📄</span>
                <span class="text-sm text-gray-700">错误日志.txt</span>
            </div>
            <div class="attachment-item">
                <span class="text-blue-500 mr-2">🖼️</span>
                <span class="text-sm text-gray-700">电源连接.jpg</span>
            </div>
        </div>
    </div>

    <!-- 处理记录 -->
    <div class="bg-white px-4 py-4 mb-2">
        <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">💬</span>
            处理记录
        </h3>
        
        <div class="space-y-4">
            <!-- 处理记录项 -->
            <div class="timeline-item">
                <div class="bg-blue-50 p-3 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium text-gray-800">李工程师</span>
                        <span class="text-sm text-gray-500">10:15</span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2">已到达现场开始检查，初步判断可能是电源或主板问题。</p>
                    <div class="flex items-center text-xs text-gray-500">
                        <span class="mr-3">📍 现场处理</span>
                        <span>⏱️ 耗时: 15分钟</span>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="bg-orange-50 p-3 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium text-gray-800">李工程师</span>
                        <span class="text-sm text-gray-500">10:45</span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2">更换电源线后仍无反应，准备检查主板电源接口。</p>
                    <div class="mb-2">
                        <span class="text-xs text-gray-600 block mb-1">使用耗材:</span>
                        <div class="flex flex-wrap">
                            <span class="material-chip">电源线 × 1根</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="timeline-item">
                <div class="bg-green-50 p-3 rounded-lg">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-medium text-gray-800">李工程师</span>
                        <span class="text-sm text-gray-500">11:20</span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2">发现主板电源接口松动，重新连接后电脑正常开机。问题已解决，等待用户确认。</p>
                    <div class="flex items-center text-xs text-green-600">
                        <span class="mr-3">✅ 问题已解决</span>
                        <span>⏱️ 总耗时: 1小时5分钟</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 添加记录按钮 -->
        <div class="flex justify-center mt-4 space-x-3">
            <button class="bg-blue-500 text-white px-4 py-2 rounded-lg text-sm flex items-center">
                <span class="mr-1">💬</span>
                添加记录
            </button>
            <button class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm flex items-center">
                <span class="mr-1">📷</span>
                拍照
            </button>
            <button class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg text-sm flex items-center">
                <span class="mr-1">🎤</span>
                语音
            </button>
        </div>
    </div>

    <!-- 状态历史 -->
    <div class="bg-white px-4 py-4 mb-2">
        <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
            <span class="mr-2">📊</span>
            状态历史
        </h3>
        
        <div class="space-y-3">
            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <div class="flex items-center">
                    <span class="status-resolved px-2 py-1 rounded text-xs mr-3">已解决</span>
                    <span class="text-sm text-gray-700">问题已修复，等待用户确认</span>
                </div>
                <div class="text-xs text-gray-500">
                    <div>11:20</div>
                    <div>李工程师</div>
                </div>
            </div>
            
            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <div class="flex items-center">
                    <span class="status-processing px-2 py-1 rounded text-xs mr-3">处理中</span>
                    <span class="text-sm text-gray-700">工程师正在现场处理</span>
                </div>
                <div class="text-xs text-gray-500">
                    <div>10:15</div>
                    <div>李工程师</div>
                </div>
            </div>
            
            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                <div class="flex items-center">
                    <span class="status-pending px-2 py-1 rounded text-xs mr-3">待处理</span>
                    <span class="text-sm text-gray-700">工单已分配，等待处理</span>
                </div>
                <div class="text-xs text-gray-500">
                    <div>09:45</div>
                    <div>系统</div>
                </div>
            </div>
            
            <div class="flex items-center justify-between py-2">
                <div class="flex items-center">
                    <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs mr-3">已提交</span>
                    <span class="text-sm text-gray-700">用户提交工单</span>
                </div>
                <div class="text-xs text-gray-500">
                    <div>09:30</div>
                    <div>张三</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部操作栏 -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t px-4 py-3 max-w-sm mx-auto">
        <div class="flex space-x-2">
            <button class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg text-sm font-medium" onclick="showMaterialModal('pause')">
                暂停处理
            </button>
            <button class="flex-1 bg-blue-500 text-white py-3 rounded-lg text-sm font-medium">
                继续处理
            </button>
            <button class="bg-green-500 text-white px-4 py-3 rounded-lg text-sm font-medium" onclick="showMaterialModal('complete')">
                完成
            </button>
        </div>
        
        <div class="flex justify-center mt-2 space-x-4">
            <button class="text-orange-500 text-sm flex items-center">
                <span class="mr-1">🤝</span>
                申请协助
            </button>
            <button class="text-blue-500 text-sm flex items-center" onclick="showMaterialModal('record')">
                <span class="mr-1">📦</span>
                记录耗材
            </button>
        </div>
    </div>

    <!-- 耗材弹窗 -->
    <div id="materialModal" class="modal-overlay" onclick="hideMaterialModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="p-4">
                <!-- 弹窗头部 -->
                <div class="flex items-center justify-between mb-4">
                    <h3 id="modalTitle" class="text-lg font-semibold text-gray-800">记录耗材使用</h3>
                    <button onclick="hideMaterialModal()" class="p-2 -mr-2">
                        <svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <!-- 工单信息 -->
                <div class="bg-blue-50 p-3 rounded-lg mb-4">
                    <div class="text-sm text-blue-800 font-medium">#TK001215 电脑无法开机</div>
                    <div class="text-xs text-blue-600 mt-1">📍 行政楼4楼405室 | 👤 张三</div>
                </div>
                
                <!-- 已添加的耗材 -->
                <div id="materialList" class="mb-4">
                    <div class="text-sm font-medium text-gray-800 mb-2">使用的耗材</div>
                    <!-- 耗材项目会通过JavaScript添加 -->
                </div>
                
                <!-- 快速添加常用耗材 -->
                <div class="mb-4">
                    <div class="text-sm font-medium text-gray-800 mb-2">常用耗材</div>
                    <div class="flex flex-wrap">
                        <button class="quick-material-btn" onclick="addQuickMaterial('网线', '米')">🔌 网线</button>
                        <button class="quick-material-btn" onclick="addQuickMaterial('螺丝包', '套')">🔧 螺丝包</button>
                        <button class="quick-material-btn" onclick="addQuickMaterial('打印纸', '包')">🖨️ 打印纸</button>
                        <button class="quick-material-btn" onclick="addQuickMaterial('墨盒', '个')">🖤 墨盒</button>
                        <button class="quick-material-btn" onclick="addQuickMaterial('电源线', '根')">🔌 电源线</button>
                        <button class="quick-material-btn" onclick="addQuickMaterial('数据线', '根')">📱 数据线</button>
                    </div>
                </div>
                
                <!-- 自定义添加 -->
                <div class="mb-6">
                    <div class="text-sm font-medium text-gray-800 mb-2">自定义耗材</div>
                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <input type="text" id="customMaterialName" placeholder="耗材名称" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                        <input type="number" id="customMaterialQty" placeholder="数量" value="1" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                        <select id="customMaterialUnit" class="px-3 py-2 border border-gray-200 rounded-lg text-sm">
                            <option>个</option>
                            <option>根</option>
                            <option>条</option>
                            <option>米</option>
                            <option>套</option>
                            <option>包</option>
                            <option>张</option>
                        </select>
                    </div>
                    <button onclick="addCustomMaterial()" class="w-full bg-gray-100 text-gray-700 py-2 rounded-lg text-sm">
                        + 添加到清单
                    </button>
                </div>
                
                <!-- 底部按钮 -->
                <div class="flex space-x-3">
                    <button onclick="hideMaterialModal()" class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium">
                        取消
                    </button>
                    <button id="confirmButton" onclick="confirmAction()" class="flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium">
                        确认并保存
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部安全区域 -->
    <div class="h-24"></div>

    <script>
        let currentAction = '';
        let materials = [];
        let materialIdCounter = 0;

        function showMaterialModal(action) {
            currentAction = action;
            const modal = document.getElementById('materialModal');
            const title = document.getElementById('modalTitle');
            const button = document.getElementById('confirmButton');
            
            // 根据操作类型设置标题和按钮文字
            switch (action) {
                case 'complete':
                    title.textContent = '完成工单 - 记录耗材';
                    button.textContent = '完成工单';
                    button.className = 'flex-1 bg-green-500 text-white py-3 rounded-lg font-medium';
                    break;
                case 'pause':
                    title.textContent = '暂停处理 - 记录耗材';
                    button.textContent = '暂停并保存';
                    button.className = 'flex-1 bg-orange-500 text-white py-3 rounded-lg font-medium';
                    break;
                case 'record':
                    title.textContent = '记录耗材使用';
                    button.textContent = '保存记录';
                    button.className = 'flex-1 bg-blue-500 text-white py-3 rounded-lg font-medium';
                    break;
            }
            
            modal.style.display = 'block';
            renderMaterialList();
        }

        function hideMaterialModal() {
            document.getElementById('materialModal').style.display = 'none';
        }

        function addQuickMaterial(name, unit) {
            const existingIndex = materials.findIndex(m => m.name === name);
            if (existingIndex >= 0) {
                materials[existingIndex].quantity += 1;
            } else {
                materials.push({
                    id: ++materialIdCounter,
                    name: name,
                    quantity: 1,
                    unit: unit,
                    notes: ''
                });
            }
            renderMaterialList();
        }

        function addCustomMaterial() {
            const name = document.getElementById('customMaterialName').value.trim();
            const qty = parseInt(document.getElementById('customMaterialQty').value) || 1;
            const unit = document.getElementById('customMaterialUnit').value;
            
            if (!name) {
                alert('请输入耗材名称');
                return;
            }
            
            materials.push({
                id: ++materialIdCounter,
                name: name,
                quantity: qty,
                unit: unit,
                notes: ''
            });
            
            // 清空输入框
            document.getElementById('customMaterialName').value = '';
            document.getElementById('customMaterialQty').value = '1';
            
            renderMaterialList();
        }

        function removeMaterial(id) {
            materials = materials.filter(m => m.id !== id);
            renderMaterialList();
        }

        function updateQuantity(id, quantity) {
            const material = materials.find(m => m.id === id);
            if (material) {
                material.quantity = Math.max(1, parseInt(quantity) || 1);
                renderMaterialList();
            }
        }

        function renderMaterialList() {
            const listContainer = document.getElementById('materialList');
            
            if (materials.length === 0) {
                listContainer.innerHTML = '<div class="text-sm font-medium text-gray-800 mb-2">使用的耗材</div><div class="text-sm text-gray-500 text-center py-4">暂无耗材记录</div>';
                return;
            }
            
            let html = '<div class="text-sm font-medium text-gray-800 mb-2">使用的耗材 (' + materials.length + '项)</div>';
            
            materials.forEach(material => {
                html += `
                    <div class="material-input-item">
                        <div class="flex items-center justify-between mb-2">
                            <div class="flex items-center">
                                <span class="text-base mr-2">📦</span>
                                <span class="font-medium text-gray-800">${material.name}</span>
                            </div>
                            <button onclick="removeMaterial(${material.id})" class="text-red-500 text-sm">
                                ✕ 移除
                            </button>
                        </div>
                        <div class="flex items-center space-x-2">
                            <input type="number" value="${material.quantity}" min="1" 
                                   onchange="updateQuantity(${material.id}, this.value)"
                                   class="w-16 px-2 py-1 border border-gray-200 rounded text-center text-sm">
                            <span class="text-sm text-gray-600">${material.unit}</span>
                        </div>
                    </div>
                `;
            });
            
            listContainer.innerHTML = html;
        }

        function confirmAction() {
            // 这里应该发送数据到服务器
            console.log('Action:', currentAction);
            console.log('Materials:', materials);
            
            switch (currentAction) {
                case 'complete':
                    alert('工单已完成，耗材记录已保存');
                    break;
                case 'pause':
                    alert('工单已暂停，耗材记录已保存');
                    break;
                case 'record':
                    alert('耗材记录已保存');
                    break;
            }
            
            hideMaterialModal();
        }

        // 初始化一些示例数据
        materials = [
            { id: 1, name: '网线', quantity: 3, unit: '米', notes: '更换损坏线缆' },
            { id: 2, name: '螺丝包', quantity: 1, unit: '套', notes: '固定设备' }
        ];
        materialIdCounter = 2;
    </script>
</body>
</html>