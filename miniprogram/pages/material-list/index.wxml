<!-- 耗材列表页 - 优化后的结构 -->
<view class="container">
  <!-- 搜索栏 -->
  <t-search 
    model:value="{{searchValue}}"
    placeholder="搜索耗材名称、编号"
    bind:submit="handleSearch"
    bind:clear="handleClearSearch"
    class="search-bar"
  />

  <!-- 主体内容 -->
  <view class="main-content">
    <!-- TDesign 侧边栏 -->
    <view class="sidebar-wrapper">
      <t-side-bar value="{{currentCategory}}" bind:change="onCategoryChange">
        <t-side-bar-item value="popular" label="常用" />
        <t-side-bar-item value="paper" label="纸张" />
        <t-side-bar-item value="writing" label="书写" />
        <t-side-bar-item value="print" label="打印" />
        <t-side-bar-item value="clean" label="清洁" />
      </t-side-bar>
      
      <!-- 经理专用：添加类目按钮 -->
      <view wx:if="{{isManager}}" class="add-category-btn" bindtap="manageCategories">
        <image src="/assets/icons/common/add.png" class="add-icon" mode="aspectFit" />
        <text>添加类目</text>
      </view>
    </view>

    <!-- 产品列表 -->
    <scroll-view class="product-list" scroll-y enhanced show-scrollbar="{{false}}">
      <view class="product-list-content">
        <!-- 产品卡片 - 优化布局 -->
        <view wx:for="{{materials}}" wx:key="_id" class="product-card" data-id="{{item._id}}" bindtap="goToDetail">
          <!-- 缺货警示条 -->
          <view wx:if="{{item.stockStatus === 'danger'}}" class="stock-alert"></view>
          
          <!-- 库存标识 - 移到右上角 -->
          <view class="stock-badge-wrapper">
            <t-tag theme="{{item.stockStatus === 'danger' ? 'danger' : item.stockStatus === 'warning' ? 'warning' : 'success'}}" variant="light" size="small">
              {{item.stockStatusText}}
            </t-tag>
          </view>
          
          <!-- 产品主体内容 -->
          <view class="product-main">
            <!-- 产品图片 -->
            <image 
              wx:if="{{item.defaultImage}}"
              class="product-image" 
              src="{{item.defaultImage}}"
              mode="aspectFill"
              lazy-load
            />
            <view wx:else class="product-image placeholder">
              <text>{{item.name[0]}}</text>
            </view>
            
            <!-- 产品信息 -->
            <view class="product-info">
              <text class="product-name">{{item.name}}</text>
              <text class="product-desc">{{item.description}}</text>
              <text class="product-stock">库存: {{item.stockInfo}}</text>
            </view>
          </view>
          
          <!-- 操作区 - 移到右下角 -->
          <view class="product-action" catchtap="stopPropagation">
            <!-- 单规格：步进器 -->
            <t-stepper 
              wx:if="{{item.variants.length === 1}}"
              value="{{item.quantity || 0}}"
              min="0"
              max="99"
              data-id="{{item._id}}"
              bind:change="onQuantityChange"
              theme="filled"
              size="medium"
            />
            
            <!-- 多规格：选择按钮 -->
            <t-button 
              wx:else
              size="medium"
              theme="primary"
              data-id="{{item._id}}"
              bind:tap="selectSpec"
            >
              选规格
            </t-button>
          </view>
        </view>
        
        <!-- 空状态 -->
        <view wx:if="{{!loading && materials.length === 0}}" class="empty-container">
          <t-empty 
            icon="info-circle"
            description="{{currentCategory === 'popular' ? '暂无常用耗材' : '该类目暂无耗材'}}"
          />
        </view>
        
        <!-- 加载中 -->
        <view wx:if="{{loading}}" class="loading-container">
          <t-loading theme="circular" size="40rpx" text="加载中..." />
        </view>
        
        <!-- 经理专用：添加耗材按钮 -->
        <view wx:if="{{isManager && !loading}}" class="add-product-card" bindtap="addProduct">
          <image src="/assets/icons/common/plus.png" class="add-product-icon" mode="aspectFit" />
          <text class="add-product-text">添加新耗材</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 简化的底部栏 - 浮动购物车按钮 -->
  <view class="float-cart" bindtap="goToCart">
    <t-badge count="{{cartCount}}" max-count="99" wx:if="{{cartCount > 0}}">
      <image src="/assets/icons/business/cart_fill.png" class="cart-icon" mode="aspectFit" />
    </t-badge>
    <image wx:else src="/assets/icons/business/cart_white.png" class="cart-icon" mode="aspectFit" />
  </view>
</view>