<!-- 处理历史功能测试页面 -->
<view class="test-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">处理历史功能测试</text>
    <text class="page-desc">验证后端processHistory功能是否正常</text>
  </view>

  <!-- 测试控制 -->
  <view class="test-control">
    <button 
      class="test-btn primary" 
      bindtap="runFullTest"
      disabled="{{isRunning}}"
    >
      {{isRunning ? '测试运行中...' : '开始完整测试'}}
    </button>
    
    <button 
      class="test-btn danger" 
      bindtap="clearTestData"
      disabled="{{isRunning || !testTicketId}}"
    >
      清除测试数据
    </button>
  </view>

  <!-- 当前测试状态 -->
  <view class="current-test" wx:if="{{currentTest}}">
    <text class="test-label">当前测试：</text>
    <text class="test-name">{{currentTest}}</text>
  </view>

  <!-- 测试工单信息 -->
  <view class="ticket-info" wx:if="{{testTicketId}}">
    <text class="info-label">测试工单ID：</text>
    <text class="info-value">{{testTicketId}}</text>
  </view>

  <!-- 测试结果 -->
  <view class="test-results" wx:if="{{testResults.length > 0}}">
    <view class="section-title">测试结果</view>
    <view class="result-list">
      <view class="result-item {{item.type}}" wx:for="{{testResults}}" wx:key="index">
        <text class="result-time">[{{item.time}}]</text>
        <text class="result-message">{{item.message}}</text>
      </view>
    </view>
  </view>

  <!-- 处理历史展示 -->
  <view class="process-history" wx:if="{{processHistory.length > 0}}">
    <view class="section-title">处理历史记录 ({{processHistory.length}}条)</view>
    
    <view class="history-timeline">
      <view class="history-item" wx:for="{{processHistory}}" wx:key="id">
        <!-- 时间线 -->
        <view class="timeline-left">
          <view class="timeline-dot {{item.action}}"></view>
          <view class="timeline-line" wx:if="{{index < processHistory.length - 1}}"></view>
        </view>
        
        <!-- 内容 -->
        <view class="history-content">
          <view class="history-header">
            <text class="history-action">{{item.description}}</text>
            <text class="history-time">{{item.timeStr}}</text>
          </view>
          
          <view class="history-details">
            <text class="detail-item">操作人: {{item.operator}}</text>
            <text class="detail-item">动作: {{item.action}}</text>
            <text class="detail-item" wx:if="{{item.operatorId}}">ID: {{item.operatorId}}</text>
          </view>
          
          <!-- 退回原因特别显示 -->
          <view class="reject-reason" wx:if="{{item.action === 'rejected' && item.reason}}">
            <view class="reason-label">退回原因：</view>
            <text class="reason-text">{{item.reason}}</text>
          </view>
          
          <!-- 解决方案显示 -->
          <view class="solution-box" wx:if="{{item.action === 'resolved' && item.solution}}">
            <view class="solution-label">解决方案：</view>
            <text class="solution-text">{{item.solution}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 提示信息 -->
  <view class="tips" wx:if="{{!isRunning && testResults.length === 0}}">
    <text class="tip-title">测试说明：</text>
    <text class="tip-item">1. 点击"开始完整测试"运行自动测试</text>
    <text class="tip-item">2. 测试将创建工单并执行完整流程</text>
    <text class="tip-item">3. 重点验证退回原因是否正确记录</text>
    <text class="tip-item">4. 测试完成后可查看完整历史记录</text>
  </view>
</view>