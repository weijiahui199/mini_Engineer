<!-- å·¥å•åˆ—è¡¨é¡µé¢ -->
<view class="ticket-list-container">
  <!-- æœç´¢æ  -->
  <view class="search-container">
    <t-search
      model:value="{{searchKeyword}}"
      placeholder="æœç´¢å·¥å•å·ã€æ ‡é¢˜ã€æäº¤äºº..."
      bind:change="onSearchChange"
      bind:submit="onSearch"
    />
  </view>

  <!-- ç­›é€‰æ  -->
  <view class="filter-container">
    <!-- è´Ÿè´£äººæ˜¾ç¤º -->
    <view class="assignee-display" wx:if="{{userRoleGroup === 'ç»ç†' || currentAssignee === 'my'}}">
      <text class="assignee-label">è´Ÿè´£äººï¼š</text>
      <text class="assignee-value">
        <block wx:if="{{currentAssignee === 'all'}}">å…¨éƒ¨</block>
        <block wx:elif="{{currentAssignee === 'my'}}">æˆ‘è´Ÿè´£çš„</block>
        <block wx:else>
          <block wx:for="{{assigneeOptions}}" wx:key="value">
            <text wx:if="{{item.value === currentAssignee}}">{{item.label}}</text>
          </block>
        </block>
      </text>
    </view>
    
    <scroll-view scroll-x class="filter-scroll">
      <view class="filter-tabs">
        <t-tag 
          wx:for="{{filterOptions}}" 
          wx:key="value"
          theme="{{item.value === currentFilter ? 'primary' : 'default'}}"
          variant="{{item.value === currentFilter ? 'dark' : 'outline'}}"
          bind:click="onFilterClick"
          data-value="{{item.value}}"
        >
          {{item.label}}
          <text wx:if="{{item.count > 0}}" class="filter-count">({{item.count}})</text>
        </t-tag>
        
        <t-tag 
          theme="default"
          variant="outline"
          bind:click="showMoreFilters"
        >
          <text class="filter-icon">âš™ï¸</text>
          æ›´å¤š
        </t-tag>
      </view>
    </scroll-view>
  </view>

  <!-- ç»Ÿè®¡ä¿¡æ¯ -->
  <view class="stats-bar" wx:if="{{showStats}}">
    <view class="stats-content">
      <text class="stats-text">ä»Šæ—¥å·¥å•: {{todayStats.assigned}}ä¸ª</text>
      <text class="stats-highlight">å®Œæˆç‡: {{todayStats.completionRate}}%</text>
    </view>
  </view>

  <!-- å·¥å•åˆ—è¡¨ -->
  <scroll-view 
    scroll-y="{{true}}"
    class="ticket-scroll"
    bindscrolltolower="onLoadMore"
    refresher-enabled="{{true}}"
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onPullDownRefresh"
    enhanced="{{true}}"
    bounces="{{true}}"
    show-scrollbar="{{false}}"
  >
    <view class="ticket-list" wx:if="{{ticketList.length > 0}}">
      <t-swipe-cell 
        wx:for="{{ticketList}}" 
        wx:key="id"
        right="{{getSwipeActions(item)}}"
      >
        <view 
          class="ticket-card {{item.priority === 'urgent' ? 'urgent-border' : ''}}"
          bindtap="navigateToDetail"
          data-id="{{item.id}}"
        >
          <!-- å·¥å•å¤´éƒ¨ -->
          <view class="card-header">
            <view class="header-left">
              <view class="priority-dot priority-{{item.priority}}"></view>
              <text class="ticket-no">{{item.ticketNo}}</text>
              <t-tag 
                wx:if="{{item.priority === 'urgent'}}"
                theme="danger"
                variant="light"
                size="small"
              >
                ç´§æ€¥
              </t-tag>
              <t-tag 
                wx:elif="{{item.priority === 'high'}}"
                theme="warning"
                variant="light"
                size="small"
              >
                é«˜
              </t-tag>
            </view>
            <view class="header-right">
              <t-tag 
                theme="{{getStatusTheme(item.status)}}"
                variant="light"
                size="small"
              >
                {{statusText[item.status]}}
              </t-tag>
            </view>
          </view>
          
          <!-- å·¥å•å†…å®¹ -->
          <view class="card-content">
            <text class="ticket-title">{{item.title}}</text>
            <text class="ticket-category">{{item.category}}</text>
          </view>
          
          <!-- å·¥å•ä¿¡æ¯ -->
          <view class="card-info">
            <view class="info-item">
              <text class="info-icon">ğŸ‘¤</text>
              <text class="info-text">{{item.submitter}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">ğŸ“</text>
              <text class="info-text">{{item.location}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">â°</text>
              <text class="info-text">{{item.createTime}}</text>
            </view>
            <view class="info-item" wx:if="{{item.assigneeName && userRoleGroup === 'ç»ç†' && currentAssignee === 'all'}}">
              <text class="info-icon">ğŸ‘·</text>
              <text class="info-text">{{item.assigneeName}}</text>
            </view>
          </view>
          
          <!-- æ“ä½œæŒ‰é’® -->
          <view class="card-actions">
            <t-button 
              wx:if="{{item.status === 'pending' && !item.assigned}}"
              theme="primary"
              size="small"
              bind:click="acceptTicket"
              data-id="{{item.id}}"
            >
              æ¥å—å·¥å•
            </t-button>
            <t-button 
              wx:elif="{{item.status === 'pending' && item.assigned}}"
              theme="primary"
              size="small"
              bind:click="startProcessing"
              data-id="{{item.id}}"
            >
              å¼€å§‹å¤„ç†
            </t-button>
            <t-button 
              wx:elif="{{item.status === 'processing'}}"
              theme="default"
              size="small"
              bind:click="continueProcessing"
              data-id="{{item.id}}"
            >
              ç»§ç»­å¤„ç†
            </t-button>
            
          </view>
        </view>
      </t-swipe-cell>
    </view>
    
    <!-- ç©ºçŠ¶æ€ -->
    <t-empty 
      wx:else
      icon="inbox"
      description="{{emptyText}}"
    >
      <t-button 
        slot="action" 
        theme="primary"
        bind:click="onRefresh"
      >
        åˆ·æ–°åˆ—è¡¨
      </t-button>
    </t-empty>
    
    <!-- åŠ è½½æ›´å¤š -->
    <view class="load-more" wx:if="{{hasMore && ticketList.length > 0}}">
      <t-loading theme="dots" loading="{{loadingMore}}" text="åŠ è½½ä¸­..." />
    </view>
  </scroll-view>

  <!-- é«˜çº§ç­›é€‰å¼¹çª— -->
  <t-popup 
    visible="{{filterPopupVisible}}" 
    placement="bottom"
    bind:visible-change="handleFilterPopupChange"
  >
    <view class="filter-popup">
      <view class="popup-header">
        <text class="popup-title">æ›´å¤šé€‰é¡¹</text>
        <view class="popup-actions">
          <text class="reset-btn" bindtap="resetFilters">é‡ç½®</text>
          <t-button theme="primary" size="small" bind:click="applyFilters">
            ç¡®å®š
          </t-button>
        </view>
      </view>
      
      <view class="filter-section" wx:if="{{assigneeOptions.length > 0}}">
        <text class="filter-label">è´Ÿè´£äºº</text>
        <t-radio-group 
          value="{{tempFilters.assignee}}"
          bind:change="onAssigneeFilterChange"
        >
          <t-radio 
            wx:for="{{assigneeOptions}}" 
            wx:key="value"
            label="{{item.label}}"
            value="{{item.value}}"
          />
        </t-radio-group>
      </view>
      
      <view class="filter-section">
        <text class="filter-label">æ—¶é—´èŒƒå›´</text>
        <t-radio-group 
          value="{{tempFilters.timeRange}}"
          bind:change="onTimeRangeChange"
        >
          <t-radio 
            wx:for="{{timeRangeOptions}}" 
            wx:key="value"
            label="{{item.label}}"
            value="{{item.value}}"
          />
        </t-radio-group>
      </view>
    </view>
  </t-popup>
</view>