<!-- è€—æåˆ—è¡¨é¡µ -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="navbar">
    <!-- ç¬¬ä¸€è¡Œï¼šè¿”å›æŒ‰é’®å’Œæ ‡é¢˜ -->
    <view class="navbar-header">
      <view class="navbar-left" bindtap="goBack">
        <image src="/assets/icons/common/back.png" class="nav-icon" />
        <text class="nav-title">è€—æç®¡ç†</text>
      </view>
    </view>
    <!-- ç¬¬äºŒè¡Œï¼šæœç´¢æ  -->
    <view class="navbar-search">
      <view class="search-bar" bindtap="openSearch">
        <image src="/assets/icons/common/search.png" class="search-icon" />
        <text class="search-placeholder">æœç´¢è€—æåç§°ã€ç¼–å·</text>
      </view>
    </view>
  </view>

  <!-- ä¸»ä½“å†…å®¹ -->
  <view class="main-content">
    <!-- å·¦ä¾§ç±»ç›®å¯¼èˆª -->
    <view class="category-sidebar">
      <view 
        class="category-item {{currentCategory === 'popular' ? 'active' : ''}}"
        data-category="popular"
        bindtap="switchCategory"
      >
        <text class="category-name">å¸¸ç”¨</text>
      </view>
      
      <view 
        class="category-item {{currentCategory === 'paper' ? 'active' : ''}}"
        data-category="paper"
        bindtap="switchCategory"
      >
        <text class="category-name">çº¸å¼ </text>
      </view>
      
      <view 
        class="category-item {{currentCategory === 'writing' ? 'active' : ''}}"
        data-category="writing"
        bindtap="switchCategory"
      >
        <text class="category-name">ä¹¦å†™</text>
      </view>
      
      <view 
        class="category-item {{currentCategory === 'print' ? 'active' : ''}}"
        data-category="print"
        bindtap="switchCategory"
      >
        <text class="category-name">æ‰“å°è€—æ</text>
      </view>
      
      <view 
        class="category-item {{currentCategory === 'clean' ? 'active' : ''}}"
        data-category="clean"
        bindtap="switchCategory"
      >
        <text class="category-name">æ¸…æ´/æ‚é¡¹</text>
      </view>
    </view>

    <!-- å³ä¾§äº§å“åˆ—è¡¨ -->
    <view class="product-list">
      <view class="product-list-container">
        <!-- äº§å“å¡ç‰‡ -->
        <view wx:for="{{materials}}" wx:key="_id" class="product-card">
          <!-- ç¼ºè´§æ ‡è¯† -->
          <view wx:if="{{item.stockStatus === 'danger'}}" class="stock-alert-bar"></view>
          
          <!-- äº§å“å›¾ç‰‡ -->
          <view class="product-image-wrapper">
            <image 
              wx:if="{{item.defaultImage}}"
              class="product-image" 
              src="{{item.defaultImage}}"
              mode="aspectFill"
            />
            <view wx:else class="product-image-placeholder">
              <text class="placeholder-text">{{item.name[0]}}</text>
            </view>
          </view>
          
          <view class="product-content">
            <view class="product-header">
              <view class="product-info">
                <text class="product-name">{{item.name}}</text>
                <text class="product-spec">{{item.description}}</text>
              </view>
              <view class="stock-badge stock-{{item.stockStatus}}">
                {{item.stockStatusText}}
              </view>
            </view>
            
            <view class="product-footer">
              <view class="product-price-info">
                <!-- Managerå¯ä»¥çœ‹ä»·æ ¼ï¼ŒEngineeråªçœ‹åº“å­˜ -->
                <text class="product-price" wx:if="{{userRole === 'Manager' && item.showPrice}}">Â¥{{item.priceRange}}</text>
                <text class="product-stock" wx:if="{{userRole === 'Manager'}}">åº“å­˜: {{item.stockInfo}}</text>
                <!-- Engineerè§’è‰²ï¼šåº“å­˜ä¿¡æ¯æ˜¾ç¤ºæ›´å¤§ -->
                <text class="product-stock-large" wx:else>åº“å­˜: {{item.stockInfo}}</text>
              </view>
              
              <!-- å•è§„æ ¼ï¼šæ•°é‡æ­¥è¿›å™¨ -->
              <view wx:if="{{item.variants.length === 1}}" class="quantity-stepper">
                <button 
                  class="stepper-btn minus {{item.quantity === 0 ? 'disabled' : ''}}"
                  data-id="{{item._id}}"
                  data-action="minus"
                  bindtap="updateQuantity"
                >
                  <image src="/assets/icons/common/minus.png" class="stepper-icon" />
                </button>
                <input 
                  type="number" 
                  class="quantity-input"
                  value="{{item.quantity || 0}}"
                  data-id="{{item._id}}"
                  bindinput="onQuantityInput"
                />
                <button 
                  class="stepper-btn plus"
                  data-id="{{item._id}}"
                  data-action="plus"
                  bindtap="updateQuantity"
                >
                  <image src="/assets/icons/common/plus.png" class="stepper-icon" />
                </button>
              </view>
              
              <!-- å¤šè§„æ ¼ï¼šé€‰è§„æ ¼æŒ‰é’® -->
              <button 
                wx:else 
                class="select-spec-btn"
                data-id="{{item._id}}"
                bindtap="selectSpec"
              >
                é€‰è§„æ ¼
              </button>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view wx:if="{{!loading && materials.length === 0}}" class="empty-state">
          <text class="empty-icon">ğŸ“¦</text>
          <text class="empty-text">{{currentCategory === 'popular' ? 'æš‚æ— å¸¸ç”¨è€—æ' : 'è¯¥ç±»ç›®æš‚æ— è€—æ'}}</text>
          <text class="empty-hint">{{currentCategory === 'popular' ? 'è¯·åˆ‡æ¢åˆ°å…¶ä»–ç±»ç›®æŸ¥çœ‹' : 'è¯·è”ç³»ç®¡ç†å‘˜æ·»åŠ è€—æ'}}</text>
        </view>
        
        <!-- åŠ è½½ä¸­ -->
        <view wx:if="{{loading && materials.length === 0}}" class="loading-state">
          <t-loading theme="circular" size="40rpx" text="åŠ è½½ä¸­..." />
        </view>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æ  -->
  <view class="bottom-bar">
    <!-- å·¦ä¾§ï¼šä»“åº“ä¿¡æ¯ -->
    <view class="warehouse-info">
      <view class="info-item">
        <text class="info-label">å½“å‰ä»“åº“</text>
        <text class="info-value">{{currentWarehouse}}</text>
      </view>
      <view class="info-divider"></view>
      <view class="info-item">
        <text class="info-label">åº“å­˜ç­–ç•¥</text>
        <text class="info-value">{{stockStrategy}}</text>
      </view>
    </view>
    
    <!-- å³ä¾§ï¼šç”³é¢†è½¦æŒ‰é’® -->
    <view class="cart-btn" bindtap="goToCart">
      <view class="cart-icon-wrapper">
        <image src="/assets/icons/business/cart.png" class="cart-icon" />
        <view wx:if="{{cartCount > 0}}" class="cart-badge">{{cartCount}}</view>
      </view>
      <view class="cart-info">
        <text class="cart-count">{{cartCount}}ä»¶å•†å“</text>
        <!-- Managerå¯ä»¥çœ‹æ€»ä»·ï¼ŒEngineerä¸æ˜¾ç¤ºä»·æ ¼ -->
        <text class="cart-total" wx:if="{{userRole === 'Manager'}}">Â¥{{cartTotal}}</text>
        <text class="cart-action" wx:else>å»ç”³é¢†</text>
      </view>
    </view>
  </view>
</view>