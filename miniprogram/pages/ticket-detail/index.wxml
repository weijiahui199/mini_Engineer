<!-- 工单详情页面 -->
<view class="ticket-detail-container">
  <!-- 自定义导航栏 -->
  <t-navbar 
    title="工单详情" 
    left-arrow
    bind:go-back="handleGoBack"
  />

  <!-- 工单状态条 -->
  <view class="status-bar gradient-bg">
    <view class="status-content">
      <view class="status-left">
        <text class="ticket-number">{{ticketInfo.ticketNo}}</text>
        <t-tag 
          theme="{{getStatusTheme(ticketInfo.status)}}"
          variant="light"
        >
          {{statusText[ticketInfo.status]}}
        </t-tag>
      </view>
      <view class="status-right">
        <t-tag 
          wx:if="{{ticketInfo.priority === 'urgent'}}"
          theme="danger"
          variant="light"
        >
          紧急
        </t-tag>
        <t-tag 
          wx:elif="{{ticketInfo.priority === 'high'}}"
          theme="warning"
          variant="light"
        >
          高优先级
        </t-tag>
      </view>
    </view>
  </view>

  <!-- 工单信息 -->
  <view class="section-container">
    <t-cell-group title="工单信息">
      <t-cell title="问题标题" note="{{ticketInfo.title}}" />
      <t-cell title="问题类型" note="{{ticketInfo.category}}" />
      <t-cell title="提交人" note="{{ticketInfo.submitter}}" />
      <t-cell title="联系电话" note="{{ticketInfo.phone || '未提供'}}" />
      <t-cell title="所在位置" note="{{ticketInfo.location}}" />
      <t-cell title="提交时间" note="{{ticketInfo.createTime}}" />
    </t-cell-group>
  </view>

  <!-- 问题描述 -->
  <view class="section-container">
    <view class="section-title">问题描述</view>
    <view class="description-box">
      <text class="description-text">{{ticketInfo.description || '暂无描述'}}</text>
    </view>
  </view>

  <!-- 附件信息 -->
  <view class="section-container" wx:if="{{ticketInfo.attachments && ticketInfo.attachments.length > 0}}">
    <view class="section-title">相关附件</view>
    <view class="attachment-list">
      <view 
        class="attachment-item" 
        wx:for="{{ticketInfo.attachments}}" 
        wx:key="index"
        bindtap="previewAttachment"
        data-url="{{item}}"
      >
        <t-icon name="file" size="32rpx" />
        <text class="attachment-name">附件{{index + 1}}</text>
        <t-icon name="chevron-right" size="24rpx" />
      </view>
    </view>
  </view>

  <!-- 处理进度时间线 -->
  <view class="section-container">
    <view class="section-title">处理进度</view>
    <view class="timeline">
      <view 
        class="timeline-item {{item.isActive ? 'active' : ''}}" 
        wx:for="{{processTimeline}}" 
        wx:key="id"
      >
        <view class="timeline-dot {{item.isActive ? 'active' : ''}}"></view>
        <view class="timeline-content">
          <view class="timeline-title">{{item.title}}</view>
          <view class="timeline-time">{{item.time}}</view>
          <view class="timeline-desc" wx:if="{{item.description}}">
            {{item.description}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 解决方案 -->
  <view class="section-container" wx:if="{{ticketInfo.status === 'processing' || ticketInfo.status === 'resolved'}}">
    <view class="section-title">解决方案</view>
    <view class="solution-box">
      <t-textarea
        model:value="{{solutionText}}"
        placeholder="请描述您的解决方案..."
        maxlength="500"
        indicator
        disabled="{{ticketInfo.status === 'resolved'}}"
      />
    </view>
  </view>


  <!-- 底部操作栏 -->
  <view class="bottom-actions safe-bottom" wx:if="{{showActions}}">
    <!-- 待处理状态 -->
    <view wx:if="{{ticketInfo.status === 'pending'}}" class="action-group">
      <t-button 
        theme="default"
        size="large"
        bind:click="rejectTicket"
      >
        退回
      </t-button>
      <t-button 
        theme="primary"
        size="large"
        bind:click="startProcessing"
      >
        开始处理
      </t-button>
    </view>
    
    <!-- 处理中状态 -->
    <view wx:elif="{{ticketInfo.status === 'processing'}}" class="action-group">
      <t-button 
        theme="default"
        size="large"
        bind:click="pauseProcessing"
      >
        暂停
      </t-button>
      <t-button 
        theme="success"
        size="large"
        bind:click="completeTicket"
      >
        完成工单
      </t-button>
    </view>
    
    <!-- 已解决状态 -->
    <view wx:elif="{{ticketInfo.status === 'resolved'}}" class="action-group">
      <t-button 
        theme="primary"
        size="large"
        block
        bind:click="closeTicket"
      >
        关闭工单
      </t-button>
    </view>
  </view>


</view>