<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>è€—æç®¡ç†</title>
  <style>
    :root {
      --bg: #f7f7f8;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --divider: #e5e7eb;
      --radius: 16px;
      --accent: #111827;
      --good: #10b981;
      --warn: #f59e0b;
      --btn: #2563eb;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    }

    .app { max-width: 430px; margin: 0 auto; min-height: 100%; background: var(--bg); display: grid; grid-template-rows: auto 1fr auto; }

    .topbar { position: sticky; top: 0; z-index: 30; background: var(--card); padding: 10px 12px; border-bottom: 1px solid var(--divider); display: grid; grid-template-columns: 24px 1fr; gap: 10px; align-items: center; }
    .icon { width: 24px; height: 24px; border-radius: 999px; background: #f0f2f5; display: grid; place-items: center; font-size: 14px; color: #111; cursor: pointer; }
    .search { display: flex; gap: 8px; align-items: center; padding: 10px 12px; border-radius: 999px; background: #f3f4f6; color: var(--muted); cursor: pointer; }

    .main { display: grid; grid-template-columns: 98px 1fr; gap: 10px; padding: 10px 10px 96px; }

    .categories { position: sticky; top: 66px; display: flex; flex-direction: column; gap: 8px; }
    .cat, .add-btn { background: var(--card); border-radius: 12px; padding: 12px 10px; text-align: center; color: #374151; border: 1px solid var(--divider); cursor: pointer; user-select: none; display: grid; gap: 6px; justify-items: center; }
    .cat small { color: var(--muted); font-size: 12px; }
    .cat.is-active { outline: 2px solid var(--accent); }
    .add-btn { grid-auto-flow: column; font-weight: 700; }

    .list { display: grid; gap: 14px; }
    .section-title { font-weight: 800; letter-spacing: .5px; display: flex; align-items: center; gap: 8px; color: #111827; }
    .section-title .badge { font-size: 12px; color: var(--muted); }

    .card { background: var(--card); border-radius: var(--radius); overflow: hidden; border: 1px solid var(--divider); display: grid; grid-template-columns: 110px 1fr; min-height: 110px; cursor: pointer; }
    .thumb { position: relative; background: #f1f5f9; display: grid; place-items: center; font-size: 12px; color: var(--muted); }
    .flag { position: absolute; left: 8px; top: 8px; padding: 2px 6px; font-size: 12px; border-radius: 6px; background: #eefbf4; color: #065f46; border: 1px solid #a7f3d0; }

    .info { padding: 12px; display: grid; gap: 6px; align-content: start; }
    .title { font-weight: 700; font-size: 16px; }
    .subtitle { color: var(--muted); }
    .meta { color: var(--muted); font-size: 12px; }
    .row { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-top: 6px; }
    .price { font-size: 16px; font-weight: 800; }
    .price em { font-style: normal; font-size: 12px; color: var(--muted); margin-left: 4px; font-weight: 600; }
    .btn { padding: 8px 12px; border-radius: 999px; font-weight: 700; border: 1px solid var(--divider); background: #f3f4f6; cursor: pointer; transition: .2s ease; white-space: nowrap; }
    .btn.primary { background: var(--accent); color: #fff; border-color: var(--accent); }

    .dock { position: sticky; bottom: 0; z-index: 40; background: var(--card); border-top: 1px solid var(--divider); padding: 10px 12px; display: flex; justify-content: space-between; align-items: center; gap: 10px; }
    .dock .left { display: flex; align-items: center; gap: 10px; }
    .cart { width: 42px; height: 42px; border-radius: 12px; background: var(--accent); color: #fff; display: grid; place-items: center; font-weight: 800; }
    .dock .muted { color: var(--muted); font-size: 12px; }
    .dock .cta { margin-left: auto; background: var(--accent); color: #fff; border: none; border-radius: 999px; padding: 12px 16px; font-weight: 800; }

    .search-page { position: fixed; inset: 0; background: var(--bg); display: none; grid-template-rows: auto 1fr; z-index: 50; }
    .search-head { background: var(--card); border-bottom: 1px solid var(--divider); padding: 10px 12px; display: grid; grid-template-columns: 24px 1fr; gap: 10px; align-items: center; }
    .search-input { width: 100%; padding: 10px 12px; border-radius: 999px; border: 1px solid var(--divider); outline: none; }
    .results { padding: 12px; display: grid; gap: 12px; }

    /* äº§å“è¯¦æƒ…é¡µ */
    .detail-page { position: fixed; inset: 0; background: var(--bg); display: none; overflow-y: auto; z-index: 60; }
    .detail-head { display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--card); border-bottom: 1px solid var(--divider); }
    .detail-hero { width: 100%; height: 200px; background: #e5e7eb; display: grid; place-items: center; overflow: hidden; }
    .detail-hero img { max-width: 100%; max-height: 100%; object-fit: cover; }
    .detail-body { padding: 16px; display: grid; gap: 16px; }
    .spec-options, .input-group { display: grid; gap: 8px; }
    .option-btn { padding: 8px 12px; border: 1px solid var(--divider); border-radius: 8px; cursor: pointer; background: var(--card); }
    .option-btn.active { border-color: var(--btn); background: #eff6ff; color: var(--btn); font-weight: 700; }
    .qty-control { display: flex; gap: 8px; align-items: center; }
    .qty-btn { width: 28px; height: 28px; border-radius: 6px; border: 1px solid var(--divider); display: grid; place-items: center; cursor: pointer; }
    .detail-footer { position: sticky; bottom: 0; background: var(--card); padding: 12px; border-top: 1px solid var(--divider); }
    .submit-btn { width: 100%; padding: 12px; background: var(--btn); color: #fff; font-weight: 700; border-radius: 999px; border: none; cursor: pointer; }
  </style>
</head>
<body>
  <div class="app">
    <header class="topbar"><div class="icon">âŸµ</div><div class="search" id="openSearch"><span>ğŸ”</span><span>æœç´¢è€—æåç§° / å‹å·</span></div></header>
    <div class="main">
      <aside class="categories">
        <div class="add-btn" id="addItem">â• æ·»åŠ è€—æ</div>
        <div class="cat is-active" data-target="fav"><div>ğŸ“Œ</div><div>å¸¸ç”¨</div></div>
        <div class="cat" data-target="paper"><div>ğŸ“„</div><div>çº¸å¼ </div></div>
        <div class="cat" data-target="writing"><div>âœ’ï¸</div><div>ä¹¦å†™</div></div>
        <div class="cat" data-target="print"><div>ğŸ–¨ï¸</div><div>æ‰“å°è€—æ</div></div>
        <div class="cat" data-target="clean"><div>ğŸ§¹</div><div>æ¸…æ´/æ‚é¡¹</div></div>
      </aside>
      <section class="list" id="list"></section>
    </div>
    <footer class="dock"><div class="left"><div class="cart">ä»“</div><div><div class="muted">å½“å‰ä»“åº“ï¼šæ€»éƒ¨ä»“</div><div class="muted">ä½äºé˜ˆå€¼é«˜äº®æé†’</div></div></div><button class="cta" id="newRequest">æ–°å»ºç”³é¢†å•</button></footer>
  </div>

  <div class="search-page" id="searchPage"><div class="search-head"><div class="icon" id="closeSearch">âŸµ</div><input class="search-input" id="searchInput" placeholder="è¾“å…¥åç§°/å‹å·/ç±»ç›®å…³é”®å­—â€¦" /></div><div class="results" id="searchResults"></div></div>

  <!-- äº§å“è¯¦æƒ…é¡µ -->
  <div class="detail-page" id="detailPage">
    <div class="detail-head"><div class="icon" id="closeDetail">âŸµ</div><div id="detailTitle">è€—æè¯¦æƒ…</div></div>
    <div class="detail-hero" id="detailHero"><span style="color:var(--muted)">æš‚æ— å›¾ç‰‡</span></div>
    <div class="detail-body">
      <div id="detailSpec"></div>
      <div class="input-group">
        <label>æ•°é‡</label>
        <div class="qty-control"><div class="qty-btn" id="minusQty">-</div><div id="qtyValue">1</div><div class="qty-btn" id="plusQty">+</div></div>
      </div>
      <div class="input-group">
        <label>ä¸Šä¼ äº§å“ç…§ç‰‡</label>
        <input type="file" id="uploadPhoto" accept="image/*" />
      </div>
    </div>
    <div class="detail-footer"><button class="submit-btn" id="confirmDetail">é€‰å¥½äº†</button></div>
  </div>

  <script>
    const items = [
      { id: 'a1', name: 'A4å¤å°çº¸ 70g', specs: [{label:'500å¼ /åŒ…', price:18.9},{label:'1000å¼ /ç®±', price:35.0}], stock:42, min:10, cat:'paper', flag:'å¸¸ç”¨', img:'' },
      { id: 'a2', name: 'ç­¾å­—ç¬” 0.5mm', specs: [{label:'12æ”¯/ç›’', price:15.0}], stock:8, min:12, cat:'writing', img:'' },
      { id: 'a3', name: 'æ‰“å°æœºå¢¨ç²‰ TN-2325', specs: [{label:'2600é¡µ', price:129},{label:'é«˜å®¹6000é¡µ', price:199}], stock:3, min:5, cat:'print', flag:'ç´§ç¼º', img:'' }
    ];

    const sections = [
      { id:'fav', title:'å¸¸ç”¨' },
      { id:'paper', title:'çº¸å¼ ' },
      { id:'writing', title:'ä¹¦å†™' },
      { id:'print', title:'æ‰“å°è€—æ' },
      { id:'clean', title:'æ¸…æ´/æ‚é¡¹' }
    ];

    const listEl = document.getElementById('list');
    const detailPage = document.getElementById('detailPage');
    const detailTitle = document.getElementById('detailTitle');
    const detailSpec = document.getElementById('detailSpec');
    const qtyValue = document.getElementById('qtyValue');
    const detailHero = document.getElementById('detailHero');
    const uploadPhoto = document.getElementById('uploadPhoto');
    let currentItem = null; let qty = 1; let chosenSpec = null;

    function cardTpl(item){
      return `<article class="card" data-id="${item.id}"><div class="thumb">${item.name.slice(0,2)}</div><div class="info"><div class="title">${item.name}</div><div class="subtitle">${item.specs.map(s=>s.label).join(' / ')}</div><div class="row"><div class="price">Â¥${item.specs[0].price}<em>/ä»¶</em></div><button class="btn">${item.specs.length>1? 'é€‰è§„æ ¼':'ï¼‹'}</button></div></div></article>`;
    }

    function renderList(){
      listEl.innerHTML='';
      sections.forEach(sec=>{
        const group = items.filter(i=>i.cat===sec.id || (sec.id==='fav'&&i.flag==='å¸¸ç”¨'));
        if(group.length===0) return;
        listEl.insertAdjacentHTML('beforeend',`<h3 class="section-title"><span>${sec.title}</span></h3>`);
        group.forEach(i=> listEl.insertAdjacentHTML('beforeend', cardTpl(i)));
      });
    }
    renderList();

    document.addEventListener('click',e=>{
      const card = e.target.closest('.card');
      if(card){
        const item = items.find(x=>x.id===card.dataset.id);
        if(!item) return;
        if(item.specs.length>1 || e.target.classList.contains('btn')){ // æ‰“å¼€è¯¦æƒ…é¡µ
          currentItem = item; qty=1; chosenSpec=item.specs[0];
          detailTitle.textContent=item.name;
          detailSpec.innerHTML = '<label>è§„æ ¼</label><div class="spec-options">'+item.specs.map((s,i)=>`<div class="option-btn ${i===0?'active':''}" data-price="${s.price}" data-label="${s.label}">${s.label} Â¥${s.price}</div>`).join('')+'</div>';
          qtyValue.textContent=qty;
          if(item.img){ detailHero.innerHTML = `<img src="${item.img}" alt="${item.name}" />`; } else { detailHero.innerHTML = '<span style="color:var(--muted)">æš‚æ— å›¾ç‰‡</span>'; }
          detailPage.style.display='block';
        } else { // å•è§„æ ¼ç›´æ¥åŠ å‡
          alert('å·²åŠ å…¥è´­ç‰©è½¦: '+item.name);
        }
      }
      const opt = e.target.closest('.option-btn');
      if(opt){
        document.querySelectorAll('.option-btn').forEach(b=>b.classList.remove('active'));
        opt.classList.add('active');
        chosenSpec={label:opt.dataset.label, price:parseFloat(opt.dataset.price)};
      }
      if(e.target.id==='minusQty'){ qty=Math.max(1,qty-1); qtyValue.textContent=qty; }
      if(e.target.id==='plusQty'){ qty++; qtyValue.textContent=qty; }
      if(e.target.id==='closeDetail'){ detailPage.style.display='none'; }
      if(e.target.id==='confirmDetail'){ alert(`å·²é€‰æ‹© ${currentItem.name} - ${chosenSpec.label} Ã— ${qty}`); detailPage.style.display='none'; }
    });

    uploadPhoto.addEventListener('change', e=>{
      const file = e.target.files[0];
      if(file){
        const reader = new FileReader();
        reader.onload = ev => {
          detailHero.innerHTML = `<img src="${ev.target.result}" alt="ä¸Šä¼ çš„ç…§ç‰‡" />`;
          if(currentItem) currentItem.img = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });


