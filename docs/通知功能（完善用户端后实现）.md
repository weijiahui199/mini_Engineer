# å·¥å•è®¢é˜…æ¶ˆæ¯é€šçŸ¥åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿°å¾®ä¿¡å°ç¨‹åºITå·¥ç¨‹å¸ˆå·¥ä½œå°çš„è®¢é˜…æ¶ˆæ¯é€šçŸ¥åŠŸèƒ½è®¾è®¡æ–¹æ¡ˆã€‚ç³»ç»Ÿåˆ†ä¸º**ç”¨æˆ·ç«¯**å’Œ**å·¥ç¨‹å¸ˆç«¯**ä¸¤ä¸ªç‹¬ç«‹çš„å°ç¨‹åºï¼Œé’ˆå¯¹ä¸åŒè§’è‰²æä¾›å·®å¼‚åŒ–çš„é€šçŸ¥æœåŠ¡ã€‚

## ğŸ¯ åŠŸèƒ½ç›®æ ‡

### ç”¨æˆ·ç«¯ï¼ˆåˆ›å»ºå·¥å•æ–¹ï¼‰
1. **å·¥å•å®Œæˆé€šçŸ¥**ï¼šå·¥å•å·²è§£å†³ï¼Œé‚€è¯·ç”¨æˆ·è¯„ä»·
2. **å·¥å•å…³é—­é€šçŸ¥**ï¼šå·¥å•å·²å…³é—­ï¼Œæµç¨‹ç»“æŸ
3. **å¤„ç†è¿›åº¦é€šçŸ¥**ï¼šå·¥å•å¤„ç†çš„é‡è¦èŠ‚ç‚¹æ›´æ–°ï¼ˆå¯é€‰ï¼‰

### å·¥ç¨‹å¸ˆç«¯ï¼ˆå¤„ç†å·¥å•æ–¹ï¼‰
1. **æ–°å·¥å•é€šçŸ¥**ï¼šæœ‰æ–°å·¥å•è¿›å…¥å·¥å•æ± 
2. **ç´§æ€¥å·¥å•é€šçŸ¥**ï¼šé«˜ä¼˜å…ˆçº§å·¥å•æé†’
3. **ç»ç†é€šçŸ¥**ï¼šç»ç†å‘å¸ƒçš„å…¬å‘Šã€ä»»åŠ¡åˆ†é…ç­‰
4. **å·¥å•åˆ†é…é€šçŸ¥**ï¼šç»ç†æŒ‡å®šå·¥å•ç»™ç‰¹å®šå·¥ç¨‹å¸ˆ

## ğŸ— ç³»ç»Ÿæ¶æ„

### 1. æ•´ä½“æµç¨‹

#### ç”¨æˆ·ç«¯æµç¨‹
```
å·¥ç¨‹å¸ˆè§£å†³å·¥å•
    â†“
æ›´æ–°å·¥å•çŠ¶æ€ä¸ºå·²è§£å†³
    â†“
è§¦å‘é€šçŸ¥äº‘å‡½æ•°
    â†“
å‘é€å®Œæˆé€šçŸ¥ç»™ç”¨æˆ·
    â†“
ç”¨æˆ·æ”¶åˆ°é€šçŸ¥å¹¶è¯„ä»·
```

#### å·¥ç¨‹å¸ˆç«¯æµç¨‹
```
ç”¨æˆ·åˆ›å»ºå·¥å•
    â†“
å·¥å•è¿›å…¥å·¥å•æ± 
    â†“
è§¦å‘é€šçŸ¥äº‘å‡½æ•°
    â†“
ç­›é€‰åœ¨çº¿å·¥ç¨‹å¸ˆ
    â†“
å‘é€æ–°å·¥å•é€šçŸ¥
    â†“
å·¥ç¨‹å¸ˆæŸ¥çœ‹å¹¶æ¥å•
```

### 2. æ ¸å¿ƒç»„ä»¶

#### 2.1 ç”¨æˆ·ç«¯ç»„ä»¶
- **è®¢é˜…ç®¡ç†å™¨** (`/user-miniprogram/utils/subscription-manager.js`)
  - åœ¨åˆ›å»ºå·¥å•æ—¶è¯·æ±‚è®¢é˜…
  - ç®¡ç†ç”¨æˆ·è®¢é˜…çŠ¶æ€
  - ç¼“å­˜è®¢é˜…åå¥½

- **è¯„ä»·é¡µé¢é›†æˆ** (`/user-miniprogram/pages/ticket-evaluate/`)
  - æ¥æ”¶å®Œæˆé€šçŸ¥åè·³è½¬
  - æäº¤è¯„ä»·å’Œåé¦ˆ

#### 2.2 å·¥ç¨‹å¸ˆç«¯ç»„ä»¶
- **è®¢é˜…ç®¡ç†å™¨** (`/engineer-miniprogram/utils/subscription-manager.js`)
  - åœ¨ç™»å½•æ—¶è¯·æ±‚è®¢é˜…
  - ç®¡ç†å·¥ç¨‹å¸ˆè®¢é˜…çŠ¶æ€
  - å¤„ç†é€šçŸ¥åå¥½è®¾ç½®

- **é€šçŸ¥è®¾ç½®é¡µé¢** (`/engineer-miniprogram/pages/notification-settings/`)
  - è®¢é˜…å¼€å…³ç®¡ç†
  - é€šçŸ¥ç±»å‹ç­›é€‰
  - å…æ‰“æ‰°æ—¶æ®µè®¾ç½®

#### 2.3 äº‘å‡½æ•°
- **notifyUser** (`/cloudfunctions/notifyUser/`)
  - å‘ç”¨æˆ·å‘é€å·¥å•å®Œæˆ/å…³é—­é€šçŸ¥
  - ç®¡ç†ç”¨æˆ·é€šçŸ¥é˜Ÿåˆ—
  
- **notifyEngineer** (`/cloudfunctions/notifyEngineer/`)
  - å‘å·¥ç¨‹å¸ˆå‘é€æ–°å·¥å•é€šçŸ¥
  - å¤„ç†ç»ç†é€šçŸ¥åˆ†å‘
  - ç®¡ç†å·¥ç¨‹å¸ˆé€šçŸ¥é˜Ÿåˆ—

- **æ”¹é€  submitTicket**
  - å·¥å•çŠ¶æ€å˜æ›´æ—¶è§¦å‘ç›¸åº”é€šçŸ¥
  - åŒºåˆ†ç”¨æˆ·ç«¯å’Œå·¥ç¨‹å¸ˆç«¯é€šçŸ¥

### 3. æ•°æ®åº“è®¾è®¡

**æ–°å¢é›†åˆï¼šuser_subscriptionsï¼ˆç”¨æˆ·ç«¯è®¢é˜…ï¼‰**
```javascript
{
  _id: String,
  openid: String,              // ç”¨æˆ·openid
  userType: 'customer',       // ç”¨æˆ·ç±»å‹ï¼šcustomer
  templateIds: {               // è®¢é˜…çš„æ¨¡æ¿ID
    ticketComplete: String,    // å·¥å•å®Œæˆé€šçŸ¥æ¨¡æ¿
    ticketClose: String,       // å·¥å•å…³é—­é€šçŸ¥æ¨¡æ¿
    progressUpdate: String     // è¿›åº¦æ›´æ–°æ¨¡æ¿ï¼ˆå¯é€‰ï¼‰
  },
  enabled: Boolean,            // æ€»å¼€å…³
  preferences: {               // é€šçŸ¥åå¥½è®¾ç½®
    completeNotify: Boolean,   // æ¥æ”¶å®Œæˆé€šçŸ¥
    closeNotify: Boolean,      // æ¥æ”¶å…³é—­é€šçŸ¥
    progressNotify: Boolean    // æ¥æ”¶è¿›åº¦é€šçŸ¥
  },
  subscribeTime: Date,         // è®¢é˜…æ—¶é—´
  lastNotifyTime: Date,        // æœ€åé€šçŸ¥æ—¶é—´
  notifyCount: Number          // é€šçŸ¥æ¬¡æ•°ç»Ÿè®¡
}
```

**æ–°å¢é›†åˆï¼šengineer_subscriptionsï¼ˆå·¥ç¨‹å¸ˆç«¯è®¢é˜…ï¼‰**
```javascript
{
  _id: String,
  openid: String,              // å·¥ç¨‹å¸ˆopenid
  userType: 'engineer',        // ç”¨æˆ·ç±»å‹ï¼šengineer/manager
  roleGroup: String,           // è§’è‰²ï¼šå·¥ç¨‹å¸ˆ/ç»ç†
  templateIds: {               // è®¢é˜…çš„æ¨¡æ¿ID
    newTicket: String,         // æ–°å·¥å•é€šçŸ¥æ¨¡æ¿
    urgentTicket: String,      // ç´§æ€¥å·¥å•æ¨¡æ¿
    managerNotice: String,     // ç»ç†é€šçŸ¥æ¨¡æ¿
    assignTicket: String       // æŒ‡æ´¾å·¥å•æ¨¡æ¿
  },
  enabled: Boolean,            // æ€»å¼€å…³
  preferences: {               // é€šçŸ¥åå¥½è®¾ç½®
    newTicket: Boolean,        // æ¥æ”¶æ–°å·¥å•é€šçŸ¥
    urgentOnly: Boolean,       // ä»…æ¥æ”¶ç´§æ€¥å·¥å•
    managerNotice: Boolean,    // æ¥æ”¶ç»ç†é€šçŸ¥
    assignNotify: Boolean,     // æ¥æ”¶æŒ‡æ´¾é€šçŸ¥
    nightMode: Boolean,        // å¤œé—´å…æ‰“æ‰°ï¼ˆ22:00-8:00ï¼‰
    workingHoursOnly: Boolean  // ä»…å·¥ä½œæ—¶é—´ï¼ˆ9:00-18:00ï¼‰
  },
  workSchedule: {              // å·¥ä½œæ—¶é—´è¡¨
    monday: Boolean,
    tuesday: Boolean,
    wednesday: Boolean,
    thursday: Boolean,
    friday: Boolean,
    saturday: Boolean,
    sunday: Boolean
  },
  subscribeTime: Date,         // è®¢é˜…æ—¶é—´
  lastNotifyTime: Date,        // æœ€åé€šçŸ¥æ—¶é—´
  notifyCount: Number,         // é€šçŸ¥æ¬¡æ•°ç»Ÿè®¡
  dailyLimit: Number           // æ¯æ—¥é€šçŸ¥ä¸Šé™ï¼ˆé»˜è®¤20ï¼‰
}
```

**æ–°å¢é›†åˆï¼šmanager_announcementsï¼ˆç»ç†å…¬å‘Šï¼‰**
```javascript
{
  _id: String,
  title: String,               // å…¬å‘Šæ ‡é¢˜
  content: String,             // å…¬å‘Šå†…å®¹
  priority: String,            // ä¼˜å…ˆçº§ï¼šhigh/normal/low
  targetGroups: Array,         // ç›®æ ‡ç¾¤ç»„ï¼š['all', 'engineer', 'specific']
  targetOpenids: Array,        // ç‰¹å®šç›®æ ‡ï¼ˆå½“targetGroupsåŒ…å«specificæ—¶ï¼‰
  creatorOpenid: String,       // åˆ›å»ºè€…ï¼ˆç»ç†ï¼‰openid
  createTime: Date,            // åˆ›å»ºæ—¶é—´
  sendTime: Date,              // å‘é€æ—¶é—´
  status: String,              // çŠ¶æ€ï¼šdraft/sent/cancelled
  notifyCount: Number,         // å·²é€šçŸ¥äººæ•°
  readCount: Number            // å·²è¯»äººæ•°
}
```

## ğŸ“ è¯¦ç»†è®¾è®¡

### 1. è®¢é˜…æ¶ˆæ¯æ¨¡æ¿é…ç½®

éœ€è¦åœ¨å¾®ä¿¡å…¬ä¼—å¹³å°ä¸ºä¸¤ä¸ªå°ç¨‹åºåˆ†åˆ«ç”³è¯·æ¨¡æ¿ï¼š

#### ç”¨æˆ·ç«¯æ¨¡æ¿

**æ¨¡æ¿1ï¼šå·¥å•å®Œæˆé€šçŸ¥**
```
æ ‡é¢˜ï¼šæ‚¨çš„å·¥å•å·²å®Œæˆ
å†…å®¹ï¼š
å·¥å•ç¼–å·ï¼š{{character_string1.DATA}}
å®Œæˆæ—¶é—´ï¼š{{time2.DATA}}
å¤„ç†å·¥ç¨‹å¸ˆï¼š{{name3.DATA}}
å¤„ç†ç»“æœï¼š{{thing4.DATA}}
æ¸©é¦¨æç¤ºï¼š{{thing5.DATA}} ï¼ˆè¯·å¯¹æœ¬æ¬¡æœåŠ¡è¿›è¡Œè¯„ä»·ï¼‰
```

**æ¨¡æ¿2ï¼šå·¥å•å…³é—­é€šçŸ¥**
```
æ ‡é¢˜ï¼šå·¥å•å·²å…³é—­
å†…å®¹ï¼š
å·¥å•ç¼–å·ï¼š{{character_string1.DATA}}
å…³é—­æ—¶é—´ï¼š{{time2.DATA}}
å·¥å•æ ‡é¢˜ï¼š{{thing3.DATA}}
æœ€ç»ˆçŠ¶æ€ï¼š{{phrase4.DATA}}
å¤‡æ³¨è¯´æ˜ï¼š{{thing5.DATA}}
```

#### å·¥ç¨‹å¸ˆç«¯æ¨¡æ¿

**æ¨¡æ¿1ï¼šæ–°å·¥å•é€šçŸ¥**
```
æ ‡é¢˜ï¼šæ–°å·¥å•å¾…å¤„ç†
å†…å®¹ï¼š
å·¥å•ç¼–å·ï¼š{{character_string1.DATA}}
é—®é¢˜ç±»å‹ï¼š{{thing2.DATA}}
ä¼˜å…ˆçº§ï¼š{{phrase3.DATA}}
æäº¤æ—¶é—´ï¼š{{time4.DATA}}
é—®é¢˜æè¿°ï¼š{{thing5.DATA}}
```

**æ¨¡æ¿2ï¼šç´§æ€¥å·¥å•é€šçŸ¥**
```
æ ‡é¢˜ï¼šç´§æ€¥å·¥å•æé†’
å†…å®¹ï¼š
å·¥å•ç¼–å·ï¼š{{character_string1.DATA}}
ç´§æ€¥ç¨‹åº¦ï¼š{{phrase2.DATA}}
é—®é¢˜æ ‡é¢˜ï¼š{{thing3.DATA}}
æäº¤äººï¼š{{name4.DATA}}
ä½ç½®ä¿¡æ¯ï¼š{{thing5.DATA}}
```

**æ¨¡æ¿3ï¼šç»ç†é€šçŸ¥**
```
æ ‡é¢˜ï¼šç®¡ç†é€šçŸ¥
å†…å®¹ï¼š
é€šçŸ¥æ ‡é¢˜ï¼š{{thing1.DATA}}
å‘å¸ƒæ—¶é—´ï¼š{{time2.DATA}}
ä¼˜å…ˆçº§ï¼š{{phrase3.DATA}}
å‘å¸ƒäººï¼š{{name4.DATA}}
é€šçŸ¥å†…å®¹ï¼š{{thing5.DATA}}
```

### 2. å‰ç«¯å®ç°

#### 2.1 ç”¨æˆ·ç«¯å®ç°

##### è®¢é˜…ç®¡ç†å™¨
```javascript
// user-miniprogram/utils/subscription-manager.js
class UserSubscriptionManager {
  constructor() {
    this.templateIds = {
      ticketComplete: 'TEMPLATE_ID_1',  // éœ€æ›¿æ¢ä¸ºå®é™…æ¨¡æ¿ID
      ticketClose: 'TEMPLATE_ID_2'
    };
  }
  
  // åœ¨åˆ›å»ºå·¥å•æ—¶è¯·æ±‚è®¢é˜…
  async requestOnCreate() {
    const cache = wx.getStorageSync('subscription_asked') || {};
    const lastAsk = cache.lastAskTime || 0;
    const daysSinceAsk = (Date.now() - lastAsk) / (1000 * 60 * 60 * 24);
    
    // æ¯7å¤©æœ€å¤šè¯¢é—®ä¸€æ¬¡
    if (daysSinceAsk < 7) return { subscribed: false };
    
    try {
      const res = await wx.requestSubscribeMessage({
        tmplIds: [this.templateIds.ticketComplete]
      });
      
      // è®°å½•è¯¢é—®æ—¶é—´
      wx.setStorageSync('subscription_asked', {
        lastAskTime: Date.now(),
        status: res[this.templateIds.ticketComplete]
      });
      
      return { subscribed: res[this.templateIds.ticketComplete] === 'accept' };
    } catch (err) {
      console.error('[è®¢é˜…è¯·æ±‚å¤±è´¥]', err);
      return { subscribed: false };
    }
  }
}
```

##### åˆ›å»ºå·¥å•é¡µé¢é›†æˆ
```javascript
// user-miniprogram/pages/ticket-create/index.js
async submitTicket() {
  // æ™ºèƒ½è¯·æ±‚è®¢é˜…
  const subManager = new UserSubscriptionManager();
  await subManager.requestOnCreate();
  
  // æäº¤å·¥å•
  const result = await wx.cloud.callFunction({
    name: 'submitTicket',
    data: {
      action: 'submit',
      ticketData: this.data.formData,
      userOpenid: this.data.userOpenid
    }
  });
  
  // æç¤ºç”¨æˆ·
  wx.showToast({
    title: 'å·¥å•å·²æäº¤',
    icon: 'success'
  });
}
```

#### 2.2 å·¥ç¨‹å¸ˆç«¯å®ç°

##### è®¢é˜…ç®¡ç†å™¨
```javascript
// engineer-miniprogram/utils/subscription-manager.js
class EngineerSubscriptionManager {
  constructor() {
    this.templateIds = {
      newTicket: 'TEMPLATE_ID_3',      // éœ€æ›¿æ¢ä¸ºå®é™…æ¨¡æ¿ID
      urgentTicket: 'TEMPLATE_ID_4',
      managerNotice: 'TEMPLATE_ID_5'
    };
  }
  
  // åœ¨ç™»å½•æ—¶è¯·æ±‚è®¢é˜…ï¼ˆå·¥ç¨‹å¸ˆ/ç»ç†ï¼‰
  async requestOnLogin(roleGroup) {
    if (roleGroup === 'ç”¨æˆ·') return { subscribed: false };
    
    const cache = wx.getStorageSync('eng_subscription') || {};
    const lastAsk = cache.lastAskTime || 0;
    const daysSinceAsk = (Date.now() - lastAsk) / (1000 * 60 * 60 * 24);
    
    // æ¯30å¤©è¯¢é—®ä¸€æ¬¡
    if (daysSinceAsk < 30 && cache.status === 'accept') {
      return { subscribed: true, cached: true };
    }
    
    try {
      const templates = [this.templateIds.newTicket];
      if (roleGroup === 'ç»ç†') {
        templates.push(this.templateIds.managerNotice);
      }
      
      const res = await wx.requestSubscribeMessage({
        tmplIds: templates
      });
      
      // ä¿å­˜è®¢é˜…çŠ¶æ€åˆ°äº‘ç«¯
      await this.saveToCloud(res, roleGroup);
      
      return { subscribed: true };
    } catch (err) {
      console.error('[è®¢é˜…è¯·æ±‚å¤±è´¥]', err);
      return { subscribed: false };
    }
  }
  
  // ä¿å­˜åˆ°äº‘ç«¯æ•°æ®åº“
  async saveToCloud(subscriptionResult, roleGroup) {
    const db = wx.cloud.database();
    const openid = wx.getStorageSync('openid');
    
    await db.collection('engineer_subscriptions').doc(openid).set({
      data: {
        openid: openid,
        roleGroup: roleGroup,
        templateIds: this.templateIds,
        enabled: true,
        preferences: {
          newTicket: subscriptionResult[this.templateIds.newTicket] === 'accept',
          urgentOnly: false,
          nightMode: true,
          workingHoursOnly: false
        },
        subscribeTime: new Date(),
        notifyCount: 0
      }
    });
  }
}
```

##### ç™»å½•é¡µé¢é›†æˆ
```javascript
// engineer-miniprogram/pages/login/index.js
async onLoginSuccess(userInfo) {
  // å·¥ç¨‹å¸ˆæˆ–ç»ç†ç™»å½•åè¯·æ±‚è®¢é˜…
  if (userInfo.roleGroup !== 'ç”¨æˆ·') {
    const subManager = new EngineerSubscriptionManager();
    await subManager.requestOnLogin(userInfo.roleGroup);
  }
  
  // è·³è½¬åˆ°ä¸»é¡µ
  wx.switchTab({
    url: '/pages/dashboard/index'
  });
}

```

### 3. äº‘å‡½æ•°å®ç°

#### 3.1 notifyUser äº‘å‡½æ•°ï¼ˆç”¨æˆ·ç«¯é€šçŸ¥ï¼‰

```javascript
// cloudfunctions/notifyUser/index.js
const cloud = require('wx-server-sdk');
cloud.init();

const db = cloud.database();

exports.main = async (event, context) => {
  const { action, ticketData } = event;
  
  switch(action) {
    case 'ticketComplete':
      return await notifyTicketComplete(ticketData);
    case 'ticketClose':
      return await notifyTicketClose(ticketData);
    default:
      return { success: false, error: 'Unknown action' };
  }
};

// é€šçŸ¥å·¥å•å®Œæˆ
async function notifyTicketComplete(ticket) {
  try {
    // è·å–ç”¨æˆ·è®¢é˜…ä¿¡æ¯
    const subInfo = await db.collection('user_subscriptions')
      .where({ openid: ticket.openid })
      .get();
    
    if (!subInfo.data.length || !subInfo.data[0].enabled) {
      return { success: false, reason: 'User not subscribed' };
    }
    
    const sub = subInfo.data[0];
    const templateId = sub.templateIds.ticketComplete;
    
    // å‘é€è®¢é˜…æ¶ˆæ¯
    const result = await cloud.openapi.subscribeMessage.send({
      touser: ticket.openid,
      templateId: templateId,
      page: `pages/ticket-evaluate/index?id=${ticket._id}`,
      data: {
        character_string1: { value: ticket.ticketNo },
        time2: { value: formatTime(ticket.resolveTime) },
        name3: { value: ticket.assigneeName || 'å·¥ç¨‹å¸ˆ' },
        thing4: { value: truncate(ticket.solution || 'é—®é¢˜å·²è§£å†³', 20) },
        thing5: { value: 'è¯·å¯¹æœ¬æ¬¡æœåŠ¡è¿›è¡Œè¯„ä»·' }
      },
      miniprogramState: 'developer' // ç”Ÿäº§ç¯å¢ƒæ”¹ä¸º 'formal'
    });
    
    // æ›´æ–°é€šçŸ¥è®°å½•
    await updateNotifyRecord(ticket.openid, 'complete');
    
    return { success: true };
  } catch (err) {
    console.error('[é€šçŸ¥å¤±è´¥]', err);
    return { success: false, error: err.message };
  }
}

// è¾…åŠ©å‡½æ•°
function formatTime(date) {
  const d = new Date(date);
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

function truncate(str, len) {
  return str.length > len ? str.substring(0, len - 3) + '...' : str;
}
```

#### 3.2 notifyEngineer äº‘å‡½æ•°ï¼ˆå·¥ç¨‹å¸ˆç«¯é€šçŸ¥ï¼‰

```javascript
// cloudfunctions/notifyEngineer/index.js
const cloud = require('wx-server-sdk');
cloud.init();

const db = cloud.database();

exports.main = async (event, context) => {
  const { action, ticketData, announcement } = event;
  
  switch(action) {
    case 'newTicket':
      return await notifyNewTicket(ticketData);
    case 'urgentTicket':
      return await notifyUrgentTicket(ticketData);
    case 'managerNotice':
      return await notifyManagerNotice(announcement);
    default:
      return { success: false, error: 'Unknown action' };
  }
};

// é€šçŸ¥æ–°å·¥å•
async function notifyNewTicket(ticket) {
  try {
    // è·å–æ‰€æœ‰è®¢é˜…çš„å·¥ç¨‹å¸ˆ
    const engineers = await getSubscribedEngineers();
    
    // è¿‡æ»¤æ¡ä»¶
    const filtered = engineers.filter(eng => {
      // æ£€æŸ¥æ˜¯å¦å¯ç”¨
      if (!eng.enabled || !eng.preferences.newTicket) return false;
      
      // æ£€æŸ¥æ˜¯å¦åªæ¥æ”¶ç´§æ€¥å·¥å•
      if (eng.preferences.urgentOnly && ticket.priority !== 'urgent') return false;
      
      // æ£€æŸ¥å…æ‰“æ‰°æ—¶æ®µ
      if (eng.preferences.nightMode && isNightTime()) return false;
      
      // æ£€æŸ¥å·¥ä½œæ—¶é—´
      if (eng.preferences.workingHoursOnly && !isWorkingHours()) return false;
      
      return true;
    });
    
    // æ‰¹é‡å‘é€é€šçŸ¥
    const results = await Promise.all(
      filtered.map(eng => sendNewTicketNotify(eng, ticket))
    );
    
    const successCount = results.filter(r => r.success).length;
    console.log(`[æ–°å·¥å•é€šçŸ¥] æˆåŠŸå‘é€ ${successCount}/${filtered.length} æ¡`);
    
    return { success: true, notified: successCount };
  } catch (err) {
    console.error('[é€šçŸ¥æ–°å·¥å•å¤±è´¥]', err);
    return { success: false, error: err.message };
  }
}

// å‘é€æ–°å·¥å•é€šçŸ¥
async function sendNewTicketNotify(engineer, ticket) {
  try {
    const templateId = engineer.templateIds.newTicket;
    
    await cloud.openapi.subscribeMessage.send({
      touser: engineer.openid,
      templateId: templateId,
      page: `pages/ticket-detail/index?id=${ticket._id}`,
      data: {
        character_string1: { value: ticket.ticketNo },
        thing2: { value: ticket.category || 'æœªåˆ†ç±»' },
        phrase3: { value: getPriorityText(ticket.priority) },
        time4: { value: formatTime(ticket.createTime) },
        thing5: { value: truncate(ticket.description, 20) }
      },
      miniprogramState: 'developer'
    });
    
    // æ›´æ–°å‘é€è®°å½•
    await updateEngineerNotifyCount(engineer.openid);
    
    return { success: true };
  } catch (err) {
    console.error(`[å‘é€å¤±è´¥] ${engineer.openid}:`, err);
    return { success: false, error: err.message };
  }
}

// è·å–è®¢é˜…çš„å·¥ç¨‹å¸ˆ
async function getSubscribedEngineers() {
  const result = await db.collection('engineer_subscriptions')
    .where({
      enabled: true,
      roleGroup: db.command.in(['å·¥ç¨‹å¸ˆ', 'ç»ç†'])
    })
    .get();
  
  return result.data;
}

// è¾…åŠ©å‡½æ•°
function isNightTime() {
  const hour = new Date().getHours();
  return hour >= 22 || hour < 8;
}

function isWorkingHours() {
  const now = new Date();
  const hour = now.getHours();
  const day = now.getDay();
  
  // å‘¨ä¸€åˆ°å‘¨äº”ï¼Œ9:00-18:00
  return day >= 1 && day <= 5 && hour >= 9 && hour < 18;
}

function getPriorityText(priority) {
  const map = {
    urgent: 'ç´§æ€¥',
    high: 'é«˜',
    medium: 'ä¸­',
    low: 'ä½'
  };
  return map[priority] || 'æ™®é€š';
}
```

#### 3.3 æ”¹é€  submitTicket äº‘å‡½æ•°

```javascript
// cloudfunctions/submitTicket/index.js
// åœ¨ç°æœ‰å‡½æ•°ä¸­æ·»åŠ é€šçŸ¥é€»è¾‘

// å·¥å•åˆ›å»ºåé€šçŸ¥å·¥ç¨‹å¸ˆ
case 'submit':
  // ... ç°æœ‰åˆ›å»ºå·¥å•é€»è¾‘
  const newTicket = { /* æ–°åˆ›å»ºçš„å·¥å•æ•°æ® */ };
  
  // å¼‚æ­¥è§¦å‘å·¥ç¨‹å¸ˆé€šçŸ¥ï¼ˆä¸å½±å“ä¸»æµç¨‹ï¼‰
  cloud.callFunction({
    name: 'notifyEngineer',
    data: {
      action: ticket.priority === 'urgent' ? 'urgentTicket' : 'newTicket',
      ticketData: newTicket
    }
  }).then(res => {
    console.log('[é€šçŸ¥å·¥ç¨‹å¸ˆç»“æœ]', res);
  }).catch(err => {
    console.error('[é€šçŸ¥å·¥ç¨‹å¸ˆå¤±è´¥]', err);
  });
  
  return { success: true, ticketId: result._id };

// å·¥å•å®Œæˆåé€šçŸ¥ç”¨æˆ·
case 'updateStatus':
  // ... ç°æœ‰æ›´æ–°çŠ¶æ€é€»è¾‘
  
  if (event.status === 'resolved') {
    // å¼‚æ­¥è§¦å‘ç”¨æˆ·é€šçŸ¥
    cloud.callFunction({
      name: 'notifyUser',
      data: {
        action: 'ticketComplete',
        ticketData: updatedTicket
      }
    }).then(res => {
      console.log('[é€šçŸ¥ç”¨æˆ·ç»“æœ]', res);
    }).catch(err => {
      console.error('[é€šçŸ¥ç”¨æˆ·å¤±è´¥]', err);
    });
  }
  
  return { success: true };
```

### 4. é€šçŸ¥è®¾ç½®é¡µé¢ï¼ˆå·¥ç¨‹å¸ˆç«¯ï¼‰

```xml
<!-- engineer-miniprogram/pages/notification-settings/index.wxml -->
<view class="settings-container">
  <t-cell-group title="è®¢é˜…çŠ¶æ€">
    <t-cell title="è®¢é˜…æ¶ˆæ¯" note="{{subscribeStatus}}">
      <t-switch 
        slot="note" 
        value="{{subscribed}}" 
        bind:change="toggleSubscription"
      />
    </t-cell>
  </t-cell-group>
  
  <t-cell-group title="é€šçŸ¥ç±»å‹" wx:if="{{subscribed}}">
    <t-cell title="æ–°å·¥å•é€šçŸ¥">
      <t-switch 
        slot="note" 
        value="{{preferences.newTicket}}" 
        bind:change="updatePreference"
        data-key="newTicket"
      />
    </t-cell>
    
    <t-cell title="ä»…ç´§æ€¥å·¥å•">
      <t-switch 
        slot="note" 
        value="{{preferences.urgentOnly}}" 
        bind:change="updatePreference"
        data-key="urgentOnly"
      />
    </t-cell>
    
    <t-cell title="ç»ç†é€šçŸ¥" wx:if="{{roleGroup !== 'å·¥ç¨‹å¸ˆ'}}">
      <t-switch 
        slot="note" 
        value="{{preferences.managerNotice}}" 
        bind:change="updatePreference"
        data-key="managerNotice"
      />
    </t-cell>
    
    <t-cell title="å·¥å•æŒ‡æ´¾é€šçŸ¥">
      <t-switch 
        slot="note" 
        value="{{preferences.assignNotify}}" 
        bind:change="updatePreference"
        data-key="assignNotify"
      />
    </t-cell>
  </t-cell-group>
  
  <t-cell-group title="å…æ‰“æ‰°è®¾ç½®" wx:if="{{subscribed}}">
    <t-cell title="å¤œé—´å…æ‰“æ‰°" note="22:00 - 08:00">
      <t-switch 
        slot="note" 
        value="{{preferences.nightMode}}" 
        bind:change="updatePreference"
        data-key="nightMode"
      />
    </t-cell>
    
    <t-cell title="ä»…å·¥ä½œæ—¶é—´" note="å‘¨ä¸€è‡³å‘¨äº” 9:00-18:00">
      <t-switch 
        slot="note" 
        value="{{preferences.workingHoursOnly}}" 
        bind:change="updatePreference"
        data-key="workingHoursOnly"
      />
    </t-cell>
  </t-cell-group>
  
  <view class="stats" wx:if="{{subscribed}}">
    <text class="stats-title">é€šçŸ¥ç»Ÿè®¡</text>
    <view class="stats-item">
      <text>ä»Šæ—¥å·²æ¥æ”¶ï¼š{{todayCount}} æ¡</text>
      <text>ç´¯è®¡æ¥æ”¶ï¼š{{totalCount}} æ¡</text>
    </view>
  </view>
  
  <view class="tips">
    <text>æç¤ºï¼š</text>
    <text>â€¢ è®¢é˜…æ¶ˆæ¯éœ€è¦æ‚¨ä¸»åŠ¨ç¡®è®¤</text>
    <text>â€¢ ä¸€æ¬¡è®¢é˜…å¯æ”¶åˆ°ä¸€æ¡é€šçŸ¥</text>
    <text>â€¢ å»ºè®®å®šæœŸé‡æ–°è®¢é˜…ä»¥æŒç»­æ¥æ”¶é€šçŸ¥</text>
  </view>
</view>
```

### 5. ç»ç†å…¬å‘ŠåŠŸèƒ½ï¼ˆå·¥ç¨‹å¸ˆç«¯ï¼‰

```xml
<!-- engineer-miniprogram/pages/manager-announce/index.wxml -->
<view class="announce-container">
  <view class="announce-form">
    <t-input 
      label="å…¬å‘Šæ ‡é¢˜" 
      value="{{title}}" 
      bind:change="onTitleChange"
      placeholder="è¯·è¾“å…¥å…¬å‘Šæ ‡é¢˜"
    />
    
    <t-textarea
      label="å…¬å‘Šå†…å®¹"
      value="{{content}}"
      bind:change="onContentChange"
      placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹"
      maxlength="200"
    />
    
    <t-cell title="ä¼˜å…ˆçº§">
      <t-radio-group 
        slot="note"
        value="{{priority}}" 
        bind:change="onPriorityChange"
      >
        <t-radio value="high" label="é«˜" />
        <t-radio value="normal" label="æ™®é€š" />
        <t-radio value="low" label="ä½" />
      </t-radio-group>
    </t-cell>
    
    <t-cell title="æ¥æ”¶å¯¹è±¡">
      <t-checkbox-group 
        slot="note"
        value="{{targetGroups}}" 
        bind:change="onTargetChange"
      >
        <t-checkbox value="all" label="å…¨éƒ¨å·¥ç¨‹å¸ˆ" />
        <t-checkbox value="online" label="åœ¨çº¿å·¥ç¨‹å¸ˆ" />
        <t-checkbox value="specific" label="æŒ‡å®šäººå‘˜" />
      </t-checkbox-group>
    </t-cell>
    
    <view class="button-group">
      <t-button theme="primary" block bind:tap="sendAnnouncement">
        å‘é€å…¬å‘Š
      </t-button>
    </view>
  </view>
  
  <view class="history-list">
    <t-cell-group title="å†å²å…¬å‘Š">
      <t-cell 
        wx:for="{{historyList}}" 
        wx:key="_id"
        title="{{item.title}}"
        note="{{item.createTime}}"
        bind:tap="viewDetail"
        data-id="{{item._id}}"
      >
        <t-tag slot="note" theme="{{item.priority}}">
          {{item.notifyCount}}äººå·²æ”¶åˆ°
        </t-tag>
      </t-cell>
    </t-cell-group>
  </view>
</view>
```

## ğŸ”§ å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å‡†å¤‡ï¼ˆ1å¤©ï¼‰
1. âœ… è®¾è®¡æ–‡æ¡£ç¼–å†™
2. â¬œ ç”³è¯·è®¢é˜…æ¶ˆæ¯æ¨¡æ¿
   - ç”¨æˆ·ç«¯ï¼š2ä¸ªæ¨¡æ¿ï¼ˆå®Œæˆé€šçŸ¥ã€å…³é—­é€šçŸ¥ï¼‰
   - å·¥ç¨‹å¸ˆç«¯ï¼š3ä¸ªæ¨¡æ¿ï¼ˆæ–°å·¥å•ã€ç´§æ€¥å·¥å•ã€ç»ç†é€šçŸ¥ï¼‰
3. â¬œ åˆ›å»ºæ•°æ®åº“é›†åˆ
   - user_subscriptions
   - engineer_subscriptions
   - manager_announcements

### ç¬¬äºŒé˜¶æ®µï¼šç”¨æˆ·ç«¯å¼€å‘ï¼ˆ2å¤©ï¼‰
1. â¬œ å®ç°ç”¨æˆ·ç«¯ subscription-manager.js
2. â¬œ åˆ›å»º notifyUser äº‘å‡½æ•°
3. â¬œ åœ¨å·¥å•åˆ›å»ºé¡µé¢é›†æˆè®¢é˜…è¯·æ±‚
4. â¬œ åˆ›å»ºè¯„ä»·é¡µé¢ï¼ˆæ¥æ”¶é€šçŸ¥åè·³è½¬ï¼‰
5. â¬œ ä¿®æ”¹ submitTicket äº‘å‡½æ•°ï¼ˆå®Œæˆæ—¶é€šçŸ¥ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šå·¥ç¨‹å¸ˆç«¯å¼€å‘ï¼ˆ3å¤©ï¼‰
1. â¬œ å®ç°å·¥ç¨‹å¸ˆç«¯ subscription-manager.js
2. â¬œ åˆ›å»º notifyEngineer äº‘å‡½æ•°
3. â¬œ åœ¨ç™»å½•é¡µé¢é›†æˆè®¢é˜…è¯·æ±‚
4. â¬œ åˆ›å»ºé€šçŸ¥è®¾ç½®é¡µé¢
5. â¬œ å®ç°å…æ‰“æ‰°å’Œè¿‡æ»¤é€»è¾‘
6. â¬œ ä¿®æ”¹ submitTicket äº‘å‡½æ•°ï¼ˆæ–°å·¥å•é€šçŸ¥ï¼‰

### ç¬¬å››é˜¶æ®µï¼šç»ç†åŠŸèƒ½ï¼ˆ2å¤©ï¼‰
1. â¬œ åˆ›å»ºç»ç†å…¬å‘Šé¡µé¢
2. â¬œ å®ç°å…¬å‘Šå‘é€äº‘å‡½æ•°
3. â¬œ é›†æˆç»ç†é€šçŸ¥æ¨¡æ¿
4. â¬œ æ·»åŠ å…¬å‘Šå†å²ç®¡ç†

### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¼˜åŒ–ï¼ˆ2å¤©ï¼‰
1. â¬œ ç«¯åˆ°ç«¯æµ‹è¯•
2. â¬œ æ€§èƒ½ä¼˜åŒ–ï¼ˆæ‰¹é‡å‘é€ã€é˜Ÿåˆ—ç®¡ç†ï¼‰
3. â¬œ ç”¨æˆ·ä½“éªŒä¼˜åŒ–
4. â¬œ æ–‡æ¡£æ›´æ–°

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ç”¨æˆ·ç«¯
1. **æœåŠ¡ä½“éªŒæå‡**ï¼šç”¨æˆ·èƒ½åŠæ—¶çŸ¥é“å·¥å•å¤„ç†å®Œæˆï¼Œæ–¹ä¾¿è¯„ä»·
2. **æµç¨‹é€æ˜åŒ–**ï¼šç”¨æˆ·æ¸…æ¥šå·¥å•çš„æœ€ç»ˆçŠ¶æ€
3. **æ»¡æ„åº¦æé«˜**ï¼šé€šè¿‡è¯„ä»·åé¦ˆæœºåˆ¶æå‡æœåŠ¡è´¨é‡

### å·¥ç¨‹å¸ˆç«¯
1. **å“åº”é€Ÿåº¦æå‡**ï¼šæ–°å·¥å•åŠæ—¶é€šçŸ¥ï¼Œé¢„è®¡å“åº”æ—¶é—´ç¼©çŸ­60%
2. **å·¥ä½œæ•ˆç‡æé«˜**ï¼šç´§æ€¥å·¥å•ä¼˜å…ˆå¤„ç†ï¼Œé¿å…é—æ¼
3. **å›¢é˜Ÿåä½œå¢å¼º**ï¼šç»ç†é€šçŸ¥åŠŸèƒ½åŠ å¼ºå›¢é˜Ÿæ²Ÿé€š
4. **çµæ´»æ€§å¢å¼º**ï¼šä¸ªæ€§åŒ–é€šçŸ¥è®¾ç½®ï¼Œé¿å…æ‰“æ‰°

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸¤ç«¯åˆ†ç¦»**ï¼šç”¨æˆ·ç«¯å’Œå·¥ç¨‹å¸ˆç«¯æ˜¯ç‹¬ç«‹çš„å°ç¨‹åºï¼Œéœ€è¦åˆ†åˆ«ç”³è¯·æ¨¡æ¿
2. **ç”¨æˆ·æˆæƒ**ï¼šè®¢é˜…æ¶ˆæ¯éœ€è¦ç”¨æˆ·ä¸»åŠ¨æˆæƒï¼Œä¸èƒ½å¼ºåˆ¶
3. **æ¬¡æ•°é™åˆ¶**ï¼šä¸€æ¬¡è®¢é˜…åªèƒ½å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œéœ€è¦åˆç†è®¾è®¡è¯·æ±‚æ—¶æœº
4. **æ¨¡æ¿å®¡æ ¸**ï¼šæ¯ä¸ªå°ç¨‹åºçš„æ¨¡æ¿éœ€è¦å•ç‹¬å®¡æ ¸ï¼Œå¯èƒ½éœ€è¦1-3ä¸ªå·¥ä½œæ—¥
5. **AppIDåŒºåˆ†**ï¼šäº‘å‡½æ•°ä¸­éœ€è¦åŒºåˆ†ä¸åŒå°ç¨‹åºçš„AppID
6. **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å‘æ—¶ä½¿ç”¨ `miniprogramState: 'developer'`ï¼Œä¸Šçº¿æ”¹ä¸º `'formal'`
7. **éšç§åˆè§„**ï¼šä¸¤ä¸ªå°ç¨‹åºéƒ½éœ€è¦åœ¨éšç§åè®®ä¸­è¯´æ˜æ¶ˆæ¯é€šçŸ¥ç”¨é€”

## ğŸ”‘ å…³é”®æŠ€æœ¯ç‚¹

1. **å¤šå°ç¨‹åºç®¡ç†**ï¼š
   - ç”¨æˆ·ç«¯å’Œå·¥ç¨‹å¸ˆç«¯ä½¿ç”¨ä¸åŒçš„AppID
   - äº‘å‡½æ•°éœ€è¦åˆå§‹åŒ–å¯¹åº”çš„äº‘ç¯å¢ƒ
   - æ¨¡æ¿IDéœ€è¦åˆ†åˆ«ç®¡ç†

2. **è®¢é˜…ç­–ç•¥**ï¼š
   - ç”¨æˆ·ç«¯ï¼šåœ¨åˆ›å»ºå·¥å•æ—¶è¯·æ±‚ï¼Œä½é¢‘è¯¢é—®
   - å·¥ç¨‹å¸ˆç«¯ï¼šåœ¨ç™»å½•æ—¶è¯·æ±‚ï¼Œå®šæœŸåˆ·æ–°

3. **é€šçŸ¥è¿‡æ»¤**ï¼š
   - æ—¶é—´è¿‡æ»¤ï¼šå¤œé—´å…æ‰“æ‰°ã€å·¥ä½œæ—¶é—´
   - ä¼˜å…ˆçº§è¿‡æ»¤ï¼šä»…ç´§æ€¥å·¥å•
   - è§’è‰²è¿‡æ»¤ï¼šåŒºåˆ†å·¥ç¨‹å¸ˆå’Œç»ç†

4. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - æ‰¹é‡å‘é€ï¼šä½¿ç”¨Promise.allå¹¶å‘
   - å¤±è´¥é‡è¯•ï¼šè®°å½•å¤±è´¥æ—¥å¿—ï¼Œå®šæ—¶é‡è¯•
   - é™æµæ§åˆ¶ï¼šé¿å…è¶…è¿‡APIè°ƒç”¨é™åˆ¶

## ğŸ”„ åç»­ä¼˜åŒ–æ–¹å‘

### çŸ­æœŸä¼˜åŒ–ï¼ˆ1-2æœˆï¼‰
1. **æ¶ˆæ¯èšåˆ**ï¼šå¤šä¸ªå·¥å•èšåˆä¸ºä¸€æ¡æ‘˜è¦é€šçŸ¥
2. **æ™ºèƒ½æ¨é€**ï¼šæ ¹æ®å·¥ç¨‹å¸ˆåœ¨çº¿çŠ¶æ€å’Œå·¥ä½œè´Ÿè½½æ™ºèƒ½åˆ†é…
3. **é€šçŸ¥ç»Ÿè®¡**ï¼šå®Œå–„é€šçŸ¥æ•ˆæœåˆ†ædashboard

### ä¸­æœŸä¼˜åŒ–ï¼ˆ3-6æœˆï¼‰
1. **AIæ™ºèƒ½åˆ†é…**ï¼šæ ¹æ®å·¥å•å†…å®¹å’Œå·¥ç¨‹å¸ˆä¸“é•¿è‡ªåŠ¨åŒ¹é…
2. **é¢„æµ‹æ€§é€šçŸ¥**ï¼šåŸºäºå†å²æ•°æ®é¢„æµ‹å·¥å•é«˜å³°æœŸ
3. **å¤šæ¸ é“é€šçŸ¥**ï¼šé›†æˆä¼ä¸šå¾®ä¿¡ã€é‚®ä»¶ç­‰å…¶ä»–é€šçŸ¥æ¸ é“

### é•¿æœŸè§„åˆ’ï¼ˆ6æœˆ+ï¼‰
1. **è¯­éŸ³é€šçŸ¥**ï¼šé‡è¦å·¥å•æ”¯æŒè¯­éŸ³æ’­æŠ¥
2. **è§†é¢‘é€šçŸ¥**ï¼šå¤æ‚é—®é¢˜æ”¯æŒè§†é¢‘è¯´æ˜
3. **å›½é™…åŒ–æ”¯æŒ**ï¼šå¤šè¯­è¨€é€šçŸ¥æ¨¡æ¿

## ğŸ“š å‚è€ƒèµ„æ–™

### å¾®ä¿¡å®˜æ–¹æ–‡æ¡£
- [è®¢é˜…æ¶ˆæ¯åŠŸèƒ½ä»‹ç»](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html)
- [è®¢é˜…æ¶ˆæ¯å¼€å‘æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html#%E5%BC%80%E5%8F%91%E5%89%8D%E5%BF%85%E8%AF%BB)
- [æ¨¡æ¿æ¶ˆæ¯ç®¡ç†](https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/subscribe-message.html#%E6%A8%A1%E6%9D%BF%E6%B6%88%E6%81%AF%E7%AE%A1%E7%90%86)
- [è®¢é˜…æ¶ˆæ¯å‚æ•°è¯´æ˜](https://developers.weixin.qq.com/miniprogram/dev/api/open-api/subscribe-message/wx.requestSubscribeMessage.html)

### äº‘å¼€å‘ç›¸å…³
- [äº‘å¼€å‘è®¢é˜…æ¶ˆæ¯API](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/openapi/subscribeMessage.html)
- [äº‘å‡½æ•°å‘é€è®¢é˜…æ¶ˆæ¯](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-sdk-api/open/subscribeMessage/Cloud.openapi.subscribeMessage.send.html)
- [è®¢é˜…æ¶ˆæ¯äº‘è°ƒç”¨](https://developers.weixin.qq.com/miniprogram/dev/OpenApiDoc/mp-message-management/subscribe-message/sendMessage.html)

### æœ€ä½³å®è·µ
- [è®¢é˜…æ¶ˆæ¯æœ€ä½³å®è·µ](https://developers.weixin.qq.com/community/develop/article/doc/000c2449a7c3a8dd91fb1fceb5b813)
- [å¤šç«¯å¼€å‘æ¶æ„æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/framework/ability/network.html)
- [å°ç¨‹åºæ¶ˆæ¯æ¨é€é…ç½®](https://developers.weixin.qq.com/miniprogram/dev/framework/server-ability/message-push.html)

### ç›¸å…³é™åˆ¶å’Œè§„èŒƒ
- [è®¢é˜…æ¶ˆæ¯ä½¿ç”¨è§„åˆ™](https://developers.weixin.qq.com/miniprogram/product/subscribeMessage.html)
- [æ¨¡æ¿æ¶ˆæ¯å®¡æ ¸è§„èŒƒ](https://developers.weixin.qq.com/miniprogram/product/subscribeMessage.html#%E5%AE%A1%E6%A0%B8%E8%A7%84%E8%8C%83)
- [APIè°ƒç”¨é¢‘ç‡é™åˆ¶](https://developers.weixin.qq.com/miniprogram/dev/framework/performance/api-frequency.html)

---

*æ–‡æ¡£åˆ›å»ºæ—¶é—´ï¼š2025-08-18*
*æœ€åæ›´æ–°ï¼š2025-08-18*
*ä½œè€…ï¼šAI Assistant*
*çŠ¶æ€ï¼šå¾…å®¡æ‰¹*

## ä¿®è®¢è®°å½•
- v1.0 (2025-08-18): åˆå§‹è®¾è®¡ï¼ŒåŸºäºå•ä¸€å°ç¨‹åºæ¶æ„
- v2.0 (2025-08-18): é‡æ–°è®¾è®¡ï¼Œæ”¹ä¸ºç”¨æˆ·ç«¯å’Œå·¥ç¨‹å¸ˆç«¯åˆ†ç¦»æ¶æ„