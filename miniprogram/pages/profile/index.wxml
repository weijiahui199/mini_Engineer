<!-- ä¸ªäººä¸­å¿ƒé¡µé¢ -->
<view class="profile-container">
  <!-- ä¸ªäººä¿¡æ¯å¤´éƒ¨ -->
  <view class="profile-header gradient-bg">
    <view class="header-content">
      <!-- å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
      <view class="user-info">
        <view class="avatar-wrapper">
          <image 
            class="user-avatar" 
            src="{{userInfo.avatar || '/assets/default-avatar.png'}}" 
            mode="aspectFill"
            bindtap="changeAvatar"
          />
          <view class="avatar-badge" wx:if="{{userInfo.isOnline}}">
            <view class="badge-dot"></view>
          </view>
        </view>
        <view class="user-details">
          <text class="user-name">{{userInfo.name}}</text>
          <text class="user-role">{{userInfo.roleText}}</text>
          <view class="user-tags">
            <t-tag theme="primary" variant="light" size="small">{{userInfo.department}}</t-tag>
            <t-tag theme="success" variant="light" size="small" wx:if="{{userInfo.isManager}}">ç®¡ç†å‘˜</t-tag>
          </view>
        </view>
      </view>
      
      <!-- ç»Ÿè®¡æ•°æ® -->
      <view class="stats-row">
        <view class="stat-item">
          <text class="stat-value">{{stats.totalCompleted}}</text>
          <text class="stat-label">ç´¯è®¡å®Œæˆ</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{stats.monthCompleted}}</text>
          <text class="stat-label">æœ¬æœˆå®Œæˆ</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{stats.rating}}</text>
          <text class="stat-label">æœåŠ¡è¯„åˆ†</text>
        </view>
      </view>
    </view>
  </view>

  <!-- å¿«æ·å…¥å£ -->
  <view class="quick-entries">
    <view class="section-title">å¿«æ·å…¥å£</view>
    <view class="entries-grid">
      <view class="entry-item" bindtap="navigateToTickets">
        <t-icon name="task" size="48rpx" color="#0ea5e9" />
        <text class="entry-label">æˆ‘çš„å·¥å•</text>
      </view>
      <view class="entry-item" bindtap="goToMaterialStats">
        <t-icon name="box" size="48rpx" color="#10b981" />
        <text class="entry-label">è€—æç®¡ç†</text>
      </view>
      <view class="entry-item" bindtap="goToSettings">
        <t-icon name="setting" size="48rpx" color="#8b5cf6" />
        <text class="entry-label">è®¾ç½®</text>
      </view>
    </view>
  </view>

  <!-- åŠŸèƒ½åˆ—è¡¨ -->
  <view class="function-list">
    <t-cell-group theme="card">
      <t-cell 
        title="ä¸ªäººä¿¡æ¯" 
        note="æŸ¥çœ‹å’Œä¿®æ”¹ä¸ªäººèµ„æ–™"
        left-icon="user"
        arrow
        bind:click="goToUserInfo"
      />
    </t-cell-group>


    <t-cell-group theme="card">
      <t-cell 
        title="æ¶ˆæ¯é€šçŸ¥" 
        note="{{unreadCount > 0 ? unreadCount + 'æ¡æœªè¯»' : 'ç³»ç»Ÿæ¶ˆæ¯'}}"
        left-icon="notification"
        arrow
        bind:click="goToNotification"
      >
        <t-badge 
          wx:if="{{unreadCount > 0}}"
          count="{{unreadCount}}"
          slot="note"
          offset="{{[0, 0]}}"
        />
      </t-cell>
      <t-cell 
        title="è®¾ç½®" 
        note="åº”ç”¨è®¾ç½®å’Œåå¥½"
        left-icon="setting"
        arrow
        bind:click="goToSettings"
      />
      <t-cell 
        title="å¸®åŠ©ä¸åé¦ˆ" 
        note="ä½¿ç”¨å¸®åŠ©å’Œé—®é¢˜åé¦ˆ"
        left-icon="help-circle"
        arrow
        bind:click="goToHelp"
      />
      <t-cell 
        title="å…³äº" 
        note="ç‰ˆæœ¬ {{version}}"
        left-icon="info-circle"
        arrow
        bind:click="goToAbout"
      />
    </t-cell-group>
  </view>

  <!-- é€€å‡ºç™»å½•æŒ‰é’® -->
  <view class="logout-section">
    <t-button 
      theme="danger" 
      size="large"
      block
      bind:tap="logout"
    >
      é€€å‡ºç™»å½•
    </t-button>
  </view>

  <!-- è®¾ç½®å¼¹çª— -->
  <t-popup 
    visible="{{settingsVisible}}" 
    placement="bottom"
    bind:visible-change="handleSettingsChange"
  >
    <view class="settings-dialog">
      <view class="dialog-header">
        <text class="dialog-title">è®¾ç½®</text>
        <t-icon name="close" size="48rpx" bindtap="closeSettings" />
      </view>
      
      <view class="dialog-content">
        <!-- é€šçŸ¥è®¾ç½® -->
        <view class="setting-group">
          <text class="group-title">é€šçŸ¥è®¾ç½®</text>
          <t-cell title="æ–°å·¥å•é€šçŸ¥">
            <t-switch 
              slot="note"
              value="{{settings.newTicketNotify}}"
              bind:change="onNewTicketNotifyChange"
            />
          </t-cell>
          <t-cell title="å·¥å•çŠ¶æ€å˜æ›´">
            <t-switch 
              slot="note"
              value="{{settings.statusChangeNotify}}"
              bind:change="onStatusChangeNotifyChange"
            />
          </t-cell>
          <t-cell title="æ±‚åŠ©è¯·æ±‚">
            <t-switch 
              slot="note"
              value="{{settings.helpRequestNotify}}"
              bind:change="onHelpRequestNotifyChange"
            />
          </t-cell>
        </view>
        
        <!-- å·¥ä½œè®¾ç½® -->
        <view class="setting-group">
          <text class="group-title">å·¥ä½œè®¾ç½®</text>
          <t-cell title="è‡ªåŠ¨æ¥å•">
            <t-switch 
              slot="note"
              value="{{settings.autoAccept}}"
              bind:change="onAutoAcceptChange"
            />
          </t-cell>
          <t-cell 
            title="æœ€å¤§å¹¶è¡Œå·¥å•æ•°"
            note="{{settings.maxParallelTickets}}ä¸ª"
            arrow
            bind:click="setMaxParallelTickets"
          />
          <t-cell title="æ˜¾ç¤ºåœ°å›¾å¯¼èˆª">
            <t-switch 
              slot="note"
              value="{{settings.showNavigation}}"
              bind:change="onShowNavigationChange"
            />
          </t-cell>
        </view>
        
        <!-- ç•Œé¢è®¾ç½® -->
        <view class="setting-group">
          <text class="group-title">ç•Œé¢è®¾ç½®</text>
          <t-cell 
            title="ä¸»é¢˜"
            note="{{settings.theme === 'light' ? 'æµ…è‰²' : 'æ·±è‰²'}}"
            arrow
            bind:click="selectTheme"
          />
          <t-cell 
            title="å­—ä½“å¤§å°"
            note="{{settings.fontSize}}"
            arrow
            bind:click="selectFontSize"
          />
        </view>
        
        <!-- éšç§è®¾ç½® -->
        <view class="setting-group">
          <text class="group-title">éšç§è®¾ç½®</text>
          <t-cell title="æ˜¾ç¤ºåœ¨çº¿çŠ¶æ€">
            <t-switch 
              slot="note"
              value="{{settings.showOnlineStatus}}"
              bind:change="onShowOnlineStatusChange"
            />
          </t-cell>
          <t-cell 
            title="æ¸…é™¤ç¼“å­˜"
            note="{{cacheSize}}"
            arrow
            bind:click="clearCache"
          />
        </view>
        
        <!-- æµ‹è¯•è®¾ç½® -->
        <view class="setting-group">
          <text class="group-title">æµ‹è¯•åŠŸèƒ½</text>
          <t-cell title="ç®¡ç†å‘˜æ¨¡å¼">
            <t-switch 
              slot="note"
              value="{{userInfo.isManager}}"
              bind:change="onManagerModeChange"
            />
          </t-cell>
        </view>
      </view>
    </view>
  </t-popup>

  <!-- æµ‹è¯•åŠŸèƒ½åŒºåŸŸ - ä»…ç”¨äºå¼€å‘æµ‹è¯• -->
  <view class="test-section" wx:if="{{showTestSection}}">
    <view class="section-header">
      <text class="section-title">å¼€å‘æµ‹è¯•å·¥å…·</text>
      <text class="test-hint">ï¼ˆä»…å¼€å‘ç¯å¢ƒå¯è§ï¼‰</text>
    </view>
    
    <view class="test-card">
      <view class="test-buttons">
        <t-button 
          theme="primary" 
          variant="outline"
          size="medium"
          bind:click="switchToManager"
          block
        >
          ğŸ¯ åˆ‡æ¢ä¸ºç»ç†è§’è‰²
        </t-button>
        
        <t-button 
          theme="default" 
          variant="outline"
          size="medium"
          bind:click="switchToEngineer"
          block
        >
          ğŸ‘· åˆ‡æ¢ä¸ºå·¥ç¨‹å¸ˆè§’è‰²
        </t-button>
        
        <t-button 
          theme="warning" 
          variant="outline"
          size="medium"
          bind:click="createTestData"
          block
        >
          ğŸ“ åˆ›å»ºæµ‹è¯•å·¥å•
        </t-button>
      </view>
      
      <view class="current-role-info">
        <text class="info-label">å½“å‰è§’è‰²ï¼š</text>
        <t-tag theme="{{userInfo.roleGroup === 'ç»ç†' ? 'success' : 'primary'}}" size="medium">
          {{userInfo.roleGroup || 'æœªè®¾ç½®'}}
        </t-tag>
      </view>
    </view>
  </view>

</view>