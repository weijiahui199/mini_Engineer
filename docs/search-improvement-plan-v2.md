# å·¥å•æœç´¢åŠŸèƒ½å®Œå–„è®¡åˆ’ V3.0
## åŸºäº Fuse.js çš„æ™ºèƒ½æœç´¢æ–¹æ¡ˆ

## ğŸ“‹ æ¦‚è¿°
åŸºäºGitHubæœ€ä½³å®è·µç ”ç©¶ï¼Œé‡‡ç”¨"Fuse.jsæ¨¡ç³Šæœç´¢ + å·¥å•å·ç²¾ç¡®æŸ¥è¯¢"çš„æ··åˆæ–¹æ¡ˆã€‚Fuse.jsæ˜¯ä¸€ä¸ªæˆç†Ÿçš„å¼€æºæœç´¢åº“ï¼ˆApache 2.0è®¸å¯è¯ï¼‰ï¼Œå¯ä»¥å®Œå…¨å…è´¹å•†ç”¨ï¼Œä¸”åœ¨å¾®ä¿¡å°ç¨‹åºä¸­æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ã€‚

## âœ… Fuse.js å¯è¡Œæ€§åˆ†æ

### è®¸å¯è¯å’Œå•†ç”¨æ€§
| æ–¹é¢ | è¯´æ˜ |
|------|------|
| **è®¸å¯è¯ç±»å‹** | Apache License 2.0 |
| **å•†ç”¨è®¸å¯** | âœ… å®Œå…¨å…è´¹ï¼Œå¯å•†ç”¨ |
| **æºç è¦æ±‚** | æ— éœ€å¼€æºè‡ªå·±çš„ä»£ç  |
| **ä¿®æ”¹æƒé™** | å¯è‡ªç”±ä¿®æ”¹å’Œåˆ†å‘ |
| **ä¸“åˆ©ä¿æŠ¤** | Apache 2.0æä¾›ä¸“åˆ©æˆæƒ |

### å¾®ä¿¡å°ç¨‹åºå…¼å®¹æ€§
| æ£€æŸ¥é¡¹ | çŠ¶æ€ | è¯´æ˜ |
|--------|------|------|
| **NPMæ”¯æŒ** | âœ… | åŸºç¡€åº“2.2.1+æ”¯æŒ |
| **çº¯JSå®ç°** | âœ… | æ— æµè§ˆå™¨ä¾èµ– |
| **åŒ…ä½“ç§¯** | âœ… | çº¦12-15KBï¼Œå½±å“å° |
| **ES5å…¼å®¹** | âœ… | æ”¯æŒES5ç¯å¢ƒ |
| **æ— å…¨å±€ä¾èµ–** | âœ… | ä¸ä¾èµ–windowç­‰å¯¹è±¡ |

### æŠ€æœ¯é£é™©è¯„ä¼°
| é£é™©é¡¹ | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|--------|------|------|----------|
| åŒ…ä½“ç§¯å¢åŠ  | ä½ | å° | Fuse.jsä»…15KB |
| æ€§èƒ½é—®é¢˜ | ä½ | ä¸­ | æ•°æ®é‡<5000æ¡æ€§èƒ½è‰¯å¥½ |
| å…¼å®¹æ€§é—®é¢˜ | ä½ | å° | çº¯JSå®ç°ï¼Œæ— ç‰¹æ®Šä¾èµ– |
| ç»´æŠ¤é£é™© | æä½ | å° | 16.5k+ starsï¼Œæ´»è·ƒç»´æŠ¤ |

## ğŸ’¡ æ ¸å¿ƒè®¾è®¡

### 1. æ··åˆæœç´¢æ¶æ„

```
ç”¨æˆ·è¾“å…¥å…³é”®è¯
     â†“
[è¾“å…¥åˆ†æå™¨]
     â†“
åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å•å·æ ¼å¼(TKxxxxxx)
     â”œâ”€æ˜¯â”€â†’ [æ•°æ®åº“ç²¾ç¡®æŸ¥è¯¢] â†’ è¿”å›ç»“æœ
     â”‚
     â””â”€å¦â”€â†’ [Fuse.js æ¨¡ç³Šæœç´¢]
            â†“
        å¤šå­—æ®µæ™ºèƒ½åŒ¹é…
            â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ â€¢ æ ‡é¢˜ (æƒé‡2.0)  â”‚
        â”‚ â€¢ å·¥å•å· (æƒé‡1.8) â”‚
        â”‚ â€¢ æäº¤äºº (æƒé‡1.5) â”‚
        â”‚ â€¢ è´Ÿè´£äºº (æƒé‡1.5) â”‚
        â”‚ â€¢ å…¬å¸ (æƒé‡1.2)   â”‚
        â”‚ â€¢ ä½ç½® (æƒé‡1.0)   â”‚
        â”‚ â€¢ ç±»åˆ« (æƒé‡1.0)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
        æŒ‰ç›¸å…³æ€§æ’åº
            â†“
        è¿”å›æœç´¢ç»“æœ
```

### 2. æ•°æ®ç»“æ„è®¾è®¡

#### 2.1 æœç´¢ç´¢å¼•ç»“æ„
```javascript
searchIndex = {
  // ç²¾ç¡®æœç´¢ç´¢å¼•
  ticketMap: {
    'TK20250816001': { /* å·¥å•å¯¹è±¡ */ },
    'TK20250816002': { /* å·¥å•å¯¹è±¡ */ }
  },
  
  // æç¤ºè¯ç´¢å¼•
  keywords: {
    companies: Set(['è…¾è®¯', 'é˜¿é‡Œå·´å·´', 'å­—èŠ‚è·³åŠ¨']),
    categories: Set(['ç½‘ç»œé—®é¢˜', 'ç¡¬ä»¶æ•…éšœ', 'è½¯ä»¶å®‰è£…']),
    submitters: Set(['å¼ ä¸‰', 'æå››', 'ç‹äº”']),
    engineers: Set(['å·¥ç¨‹å¸ˆA', 'å·¥ç¨‹å¸ˆB', 'å·¥ç¨‹å¸ˆC']),
    locations: Set(['åŠå…¬æ¥¼A-301', 'ä¼šè®®å®¤B-201'])
  },
  
  // åå‘ç´¢å¼•ï¼ˆå…³é”®è¯â†’å·¥å•åˆ—è¡¨ï¼‰
  invertedIndex: {
    'è…¾è®¯': ['TK20250816001', 'TK20250816003'],
    'ç½‘ç»œé—®é¢˜': ['TK20250816002', 'TK20250816004'],
    'å¼ ä¸‰': ['TK20250816001', 'TK20250816005']
  }
}
```

#### 2.2 æç¤ºè¯æ•°æ®ç»“æ„
```javascript
suggestion = {
  type: 'company',        // æç¤ºè¯ç±»å‹
  value: 'è…¾è®¯',          // æç¤ºè¯å€¼
  count: 5,              // åŒ¹é…å·¥å•æ•°
  priority: 1,           // æ˜¾ç¤ºä¼˜å…ˆçº§
  icon: 'ğŸ¢',            // ç±»å‹å›¾æ ‡
  recent: true           // æ˜¯å¦æœ€è¿‘ä½¿ç”¨
}
```

## ğŸ“¦ å¾®ä¿¡å°ç¨‹åºé›†æˆæ–¹æ¡ˆ

### 1. å®‰è£…å’Œé…ç½®

#### 1.1 å®‰è£… Fuse.js
```bash
# åœ¨ miniprogram ç›®å½•ä¸‹æ‰§è¡Œ
cd miniprogram
npm init -y
npm install fuse.js --save
```

#### 1.2 æ„å»º NPM
```
1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­
2. ç‚¹å‡»èœå•ï¼šå·¥å…· â†’ æ„å»º npm
3. å‹¾é€‰"ä½¿ç”¨ npm æ¨¡å—"é€‰é¡¹
4. ç¡®è®¤ miniprogram_npm æ–‡ä»¶å¤¹ç”Ÿæˆ
```

#### 1.3 é¡¹ç›®é…ç½®
```json
// project.config.json
{
  "setting": {
    "packNpmManually": false,
    "packNpmRelationList": [],
    "nodeModules": true,
    "enhance": true,  // å¯ç”¨å¢å¼ºç¼–è¯‘
    "es6": true      // å¯ç”¨ES6è½¬ES5
  },
  "miniprogramRoot": "miniprogram/"
}
```

### 2. å®ç°æœç´¢ç®¡ç†å™¨

#### 2.1 åˆ›å»º Fuse.js æœç´¢ç±»
```javascript
// miniprogram/utils/search-manager.js
const Fuse = require('fuse.js');

class SearchManager {
  constructor() {
    this.searchIndex = null;
    this.lastUpdateTime = 0;
    this.updateInterval = 60000; // 1åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ç´¢å¼•
  }
  
  // åˆå§‹åŒ–æœç´¢ç´¢å¼•
  initializeIndex(ticketList) {
    // åˆå§‹åŒ–åŸºç¡€ç´¢å¼•
    this.searchIndex = {
      ticketMap: {},
      keywords: {
        companies: new Set(),
        categories: new Set(),
        submitters: new Set(),
        engineers: new Set(),
        locations: new Set()
      },
      invertedIndex: {},
      stats: {
        totalTickets: 0,
        indexedAt: Date.now()
      }
    };
    
    // åˆå§‹åŒ– Fuse.js å®ä¾‹
    const fuseOptions = {
      keys: [
        { name: 'title', weight: 2.0 },
        { name: 'ticketNo', weight: 1.8 },
        { name: 'submitterName', weight: 1.5 },
        { name: 'assigneeName', weight: 1.5 },
        { name: 'company', weight: 1.2 },
        { name: 'location', weight: 1.0 },
        { name: 'category', weight: 1.0 },
        { name: 'description', weight: 0.8 }
      ],
      threshold: 0.3,
      includeScore: true,
      minMatchCharLength: 2,
      shouldSort: true,
      findAllMatches: false,
      ignoreLocation: true
    };
    
    this.fuseInstance = new Fuse(ticketList, fuseOptions);
    this.buildIndex(ticketList);
  }
  
  // æ„å»ºç´¢å¼•
  buildIndex(ticketList) {
    ticketList.forEach(ticket => {
      // 1. æ·»åŠ åˆ°å·¥å•æ˜ å°„
      this.searchIndex.ticketMap[ticket.ticketNo] = ticket;
      
      // 2. æå–å…³é”®è¯
      this.extractKeywords(ticket);
      
      // 3. æ„å»ºåå‘ç´¢å¼•
      this.buildInvertedIndex(ticket);
    });
    
    this.searchIndex.stats.totalTickets = ticketList.length;
    this.lastUpdateTime = Date.now();
  }
  
  // æå–å…³é”®è¯
  extractKeywords(ticket) {
    const { keywords } = this.searchIndex;
    
    if (ticket.company) keywords.companies.add(ticket.company);
    if (ticket.category) keywords.categories.add(ticket.category);
    if (ticket.submitterName) keywords.submitters.add(ticket.submitterName);
    if (ticket.assigneeName) keywords.engineers.add(ticket.assigneeName);
    if (ticket.location) keywords.locations.add(ticket.location);
  }
  
  // æ„å»ºåå‘ç´¢å¼•
  buildInvertedIndex(ticket) {
    const fields = [
      { key: 'company', value: ticket.company },
      { key: 'category', value: ticket.category },
      { key: 'submitterName', value: ticket.submitterName },
      { key: 'assigneeName', value: ticket.assigneeName },
      { key: 'location', value: ticket.location }
    ];
    
    fields.forEach(field => {
      if (field.value) {
        if (!this.searchIndex.invertedIndex[field.value]) {
          this.searchIndex.invertedIndex[field.value] = [];
        }
        this.searchIndex.invertedIndex[field.value].push(ticket.ticketNo);
      }
    });
  }
}
```

#### 2.2 æœç´¢æ‰§è¡Œå™¨
```javascript
// miniprogram/utils/search-executor.js
class SearchExecutor {
  constructor(searchManager) {
    this.searchManager = searchManager;
    this.searchHistory = this.loadSearchHistory();
  }
  
  // æ‰§è¡Œæœç´¢
  async execute(keyword) {
    if (!keyword) return { type: 'all', results: [] };
    
    // 1. åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å•å·
    if (this.isTicketNo(keyword)) {
      return await this.searchByTicketNo(keyword);
    }
    
    // 2. ä½¿ç”¨ Fuse.js è¿›è¡Œæ¨¡ç³Šæœç´¢
    const fuseResults = this.searchManager.fuseInstance.search(keyword);
    
    // 3. ç”Ÿæˆæ™ºèƒ½æç¤ºè¯
    const suggestions = this.generateSuggestions(keyword);
    
    // 4. å¦‚æœæœ‰é«˜åˆ†åŒ¹é…ç»“æœï¼Œç›´æ¥è¿”å›
    if (fuseResults.length > 0 && fuseResults[0].score < 0.1) {
      return {
        type: 'fuzzy',
        results: fuseResults.slice(0, 20).map(r => r.item),
        suggestions: suggestions
      };
    }
    
    // 5. è¿”å›æç¤ºè¯å’Œæ¨¡ç³Šæœç´¢ç»“æœ
    return {
      type: 'mixed',
      suggestions: suggestions,
      results: fuseResults.slice(0, 10).map(r => r.item)
    };
  }
  
  // åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å•å·
  isTicketNo(keyword) {
    return /^TK\d{11,}$/i.test(keyword);
  }
  
  // å·¥å•å·æœç´¢ï¼ˆéœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼‰
  async searchByTicketNo(ticketNo) {
    // å…ˆä»æœ¬åœ°ç¼“å­˜æŸ¥æ‰¾
    const cachedTicket = this.searchManager.searchIndex.ticketMap[ticketNo.toUpperCase()];
    if (cachedTicket) {
      return {
        type: 'exact',
        source: 'cache',
        results: [cachedTicket]
      };
    }
    
    // æŸ¥è¯¢æ•°æ®åº“
    return {
      type: 'exact',
      source: 'database',
      needQuery: true,
      ticketNo: ticketNo.toUpperCase()
    };
  }
  
  // ç”Ÿæˆæ™ºèƒ½æç¤º
  generateSuggestions(keyword) {
    const suggestions = {
      exact: [],      // å®Œå…¨åŒ¹é…
      partial: [],    // éƒ¨åˆ†åŒ¹é…
      fuzzy: []       // æ¨¡ç³ŠåŒ¹é…
    };
    
    const lowerKeyword = keyword.toLowerCase();
    const { keywords } = this.searchManager.searchIndex;
    
    // æœç´¢å„ä¸ªç»´åº¦
    const dimensions = [
      { type: 'company', data: keywords.companies, icon: 'ğŸ¢', priority: 1 },
      { type: 'category', data: keywords.categories, icon: 'ğŸ“', priority: 2 },
      { type: 'engineer', data: keywords.engineers, icon: 'ğŸ‘·', priority: 3 },
      { type: 'submitter', data: keywords.submitters, icon: 'ğŸ‘¤', priority: 4 },
      { type: 'location', data: keywords.locations, icon: 'ğŸ“', priority: 5 }
    ];
    
    dimensions.forEach(dimension => {
      dimension.data.forEach(value => {
        const lowerValue = value.toLowerCase();
        const matchScore = this.calculateMatchScore(lowerKeyword, lowerValue);
        
        if (matchScore === 100) {
          // å®Œå…¨åŒ¹é…
          suggestions.exact.push(this.createSuggestion(dimension, value));
        } else if (matchScore >= 80) {
          // å¼€å¤´åŒ¹é…
          suggestions.partial.push(this.createSuggestion(dimension, value, matchScore));
        } else if (matchScore >= 60) {
          // åŒ…å«åŒ¹é…
          suggestions.fuzzy.push(this.createSuggestion(dimension, value, matchScore));
        }
      });
    });
    
    // æ’åº
    suggestions.partial.sort((a, b) => b.score - a.score);
    suggestions.fuzzy.sort((a, b) => b.score - a.score);
    
    return suggestions;
  }
  
  // è®¡ç®—åŒ¹é…åˆ†æ•°
  calculateMatchScore(keyword, value) {
    if (value === keyword) return 100;
    if (value.startsWith(keyword)) return 80 + (20 * keyword.length / value.length);
    if (value.includes(keyword)) return 60 + (20 * keyword.length / value.length);
    
    // æ‹¼éŸ³åŒ¹é…ï¼ˆå¯é€‰ï¼‰
    // if (this.pinyinMatch(keyword, value)) return 50;
    
    return 0;
  }
  
  // åˆ›å»ºæç¤ºè¯å¯¹è±¡
  createSuggestion(dimension, value, score = 100) {
    const count = this.searchManager.searchIndex.invertedIndex[value]?.length || 0;
    
    return {
      type: dimension.type,
      value: value,
      count: count,
      icon: dimension.icon,
      priority: dimension.priority,
      score: score,
      recent: this.isRecentlyUsed(value)
    };
  }
}
```

### 3. UIäº¤äº’å®ç°

#### 3.1 æœç´¢è¾“å…¥ç»„ä»¶
```xml
<!-- components/smart-search/index.wxml -->
<view class="smart-search">
  <!-- æœç´¢è¾“å…¥æ¡† -->
  <view class="search-input-wrapper">
    <image class="search-icon" src="/assets/icons/search.png" />
    <input 
      class="search-input"
      value="{{keyword}}"
      placeholder="{{placeholder}}"
      placeholder-class="placeholder"
      bindinput="onInput"
      bindconfirm="onConfirm"
      bindfocus="onFocus"
      bindblur="onBlur"
    />
    <image 
      wx:if="{{keyword}}"
      class="clear-icon" 
      src="/assets/icons/clear.png"
      bindtap="onClear"
    />
  </view>
  
  <!-- æç¤ºè¯é¢æ¿ -->
  <view 
    class="suggestions-panel" 
    wx:if="{{showSuggestions && (suggestions.exact.length || suggestions.partial.length || suggestions.fuzzy.length)}}"
  >
    <!-- ç²¾ç¡®åŒ¹é… -->
    <view class="suggestion-group" wx:if="{{suggestions.exact.length}}">
      <view class="group-title">ç²¾ç¡®åŒ¹é…</view>
      <view 
        class="suggestion-item exact"
        wx:for="{{suggestions.exact}}"
        wx:key="value"
        bindtap="onSelectSuggestion"
        data-suggestion="{{item}}"
      >
        <text class="item-icon">{{item.icon}}</text>
        <text class="item-value">{{item.value}}</text>
        <text class="item-count">{{item.count}}æ¡</text>
        <text wx:if="{{item.recent}}" class="item-tag">æœ€è¿‘</text>
      </view>
    </view>
    
    <!-- éƒ¨åˆ†åŒ¹é… -->
    <view class="suggestion-group" wx:if="{{suggestions.partial.length}}">
      <view class="group-title">ç›¸å…³ç»“æœ</view>
      <view 
        class="suggestion-item"
        wx:for="{{suggestions.partial}}"
        wx:key="value"
        bindtap="onSelectSuggestion"
        data-suggestion="{{item}}"
      >
        <text class="item-icon">{{item.icon}}</text>
        <rich-text class="item-value" nodes="{{item.highlightedValue}}"></rich-text>
        <text class="item-count">{{item.count}}æ¡</text>
      </view>
    </view>
    
    <!-- æ¨¡ç³ŠåŒ¹é… -->
    <view class="suggestion-group" wx:if="{{suggestions.fuzzy.length && showFuzzy}}">
      <view class="group-title">å¯èƒ½ç›¸å…³</view>
      <view 
        class="suggestion-item fuzzy"
        wx:for="{{suggestions.fuzzy}}"
        wx:key="value"
        bindtap="onSelectSuggestion"
        data-suggestion="{{item}}"
      >
        <text class="item-icon">{{item.icon}}</text>
        <text class="item-value">{{item.value}}</text>
        <text class="item-count">{{item.count}}æ¡</text>
      </view>
    </view>
    
    <!-- æœç´¢å†å² -->
    <view class="suggestion-group" wx:if="{{!keyword && searchHistory.length}}">
      <view class="group-title">
        <text>æœç´¢å†å²</text>
        <text class="clear-history" bindtap="onClearHistory">æ¸…é™¤</text>
      </view>
      <view 
        class="suggestion-item history"
        wx:for="{{searchHistory}}"
        wx:key="*this"
        bindtap="onSelectHistory"
        data-keyword="{{item}}"
      >
        <text class="item-icon">ğŸ•</text>
        <text class="item-value">{{item}}</text>
      </view>
    </view>
  </view>
  
  <!-- æ— ç»“æœæç¤º -->
  <view class="no-results" wx:if="{{showNoResults}}">
    <image class="no-results-icon" src="/assets/icons/no-data.png" />
    <text class="no-results-text">æœªæ‰¾åˆ°"{{keyword}}"ç›¸å…³çš„å·¥å•</text>
    <text class="no-results-hint">è¯·å°è¯•ï¼š</text>
    <view class="hint-list">
      <text>â€¢ è¾“å…¥å®Œæ•´çš„å·¥å•å·ï¼ˆå¦‚ï¼šTK20250816001ï¼‰</text>
      <text>â€¢ è¾“å…¥å…¬å¸ã€ä½ç½®æˆ–äººå‘˜çš„å®Œæ•´åç§°</text>
      <text>â€¢ ä»ä¸‹æ–¹å¿«æ·æ ‡ç­¾ä¸­é€‰æ‹©</text>
    </view>
  </view>
  
  <!-- å¿«æ·æ ‡ç­¾ -->
  <view class="quick-tags" wx:if="{{showQuickTags}}">
    <view class="tags-group">
      <text class="tags-title">å¸¸ç”¨æœç´¢</text>
      <view class="tags-list">
        <view 
          class="tag-item"
          wx:for="{{quickTags}}"
          wx:key="*this"
          bindtap="onSelectTag"
          data-tag="{{item}}"
        >
          {{item}}
        </view>
      </view>
    </view>
  </view>
</view>
```

#### 3.2 æ ·å¼è®¾è®¡
```css
/* components/smart-search/index.wxss */
.smart-search {
  position: relative;
  background: #fff;
}

.search-input-wrapper {
  display: flex;
  align-items: center;
  padding: 16rpx 24rpx;
  background: #f5f7fa;
  border-radius: 16rpx;
  margin: 20rpx;
}

.search-input {
  flex: 1;
  height: 60rpx;
  font-size: 30rpx;
  margin: 0 16rpx;
}

.suggestions-panel {
  position: absolute;
  top: 100%;
  left: 20rpx;
  right: 20rpx;
  background: #fff;
  border-radius: 16rpx;
  box-shadow: 0 8rpx 32rpx rgba(0,0,0,0.1);
  max-height: 600rpx;
  overflow-y: auto;
  z-index: 999;
}

.suggestion-group {
  padding: 16rpx 0;
  border-bottom: 1rpx solid #f0f0f0;
}

.suggestion-group:last-child {
  border-bottom: none;
}

.group-title {
  padding: 8rpx 24rpx;
  font-size: 24rpx;
  color: #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.suggestion-item {
  display: flex;
  align-items: center;
  padding: 20rpx 24rpx;
  transition: background 0.2s;
}

.suggestion-item:active {
  background: #f5f7fa;
}

.suggestion-item.exact {
  background: #e6f7ff;
}

.item-icon {
  font-size: 32rpx;
  margin-right: 16rpx;
}

.item-value {
  flex: 1;
  font-size: 30rpx;
  color: #333;
}

.item-count {
  font-size: 24rpx;
  color: #999;
  margin-left: 16rpx;
}

.item-tag {
  padding: 4rpx 12rpx;
  background: #ff9500;
  color: #fff;
  font-size: 20rpx;
  border-radius: 8rpx;
  margin-left: 12rpx;
}

/* é«˜äº®æ ·å¼ */
.highlight {
  color: #1890ff;
  font-weight: 500;
}

/* å¿«æ·æ ‡ç­¾ */
.quick-tags {
  padding: 20rpx;
}

.tags-list {
  display: flex;
  flex-wrap: wrap;
  gap: 16rpx;
  margin-top: 16rpx;
}

.tag-item {
  padding: 12rpx 24rpx;
  background: #f5f7fa;
  border-radius: 24rpx;
  font-size: 26rpx;
  color: #666;
  transition: all 0.2s;
}

.tag-item:active {
  background: #1890ff;
  color: #fff;
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

#### 4.1 å¢é‡ç´¢å¼•æ›´æ–°
```javascript
class IncrementalIndexer {
  // å¢é‡æ›´æ–°ç´¢å¼•
  updateIndex(changes) {
    const { added, modified, removed } = changes;
    
    // å¤„ç†æ–°å¢
    added.forEach(ticket => {
      this.addToIndex(ticket);
    });
    
    // å¤„ç†ä¿®æ”¹
    modified.forEach(ticket => {
      this.removeFromIndex(ticket.ticketNo);
      this.addToIndex(ticket);
    });
    
    // å¤„ç†åˆ é™¤
    removed.forEach(ticketNo => {
      this.removeFromIndex(ticketNo);
    });
    
    this.updateStats();
  }
  
  // æ·»åŠ åˆ°ç´¢å¼•
  addToIndex(ticket) {
    // æ›´æ–°å·¥å•æ˜ å°„
    this.searchIndex.ticketMap[ticket.ticketNo] = ticket;
    
    // æ›´æ–°å…³é”®è¯ç´¢å¼•
    this.extractKeywords(ticket);
    
    // æ›´æ–°åå‘ç´¢å¼•
    this.updateInvertedIndex(ticket, 'add');
  }
  
  // ä»ç´¢å¼•ç§»é™¤
  removeFromIndex(ticketNo) {
    const ticket = this.searchIndex.ticketMap[ticketNo];
    if (!ticket) return;
    
    // æ›´æ–°åå‘ç´¢å¼•
    this.updateInvertedIndex(ticket, 'remove');
    
    // åˆ é™¤å·¥å•æ˜ å°„
    delete this.searchIndex.ticketMap[ticketNo];
  }
}
```

#### 4.2 æœç´¢ç»“æœç¼“å­˜
```javascript
class SearchCache {
  constructor() {
    this.cache = new Map();
    this.maxSize = 50;
    this.ttl = 60000; // 1åˆ†é’Ÿ
  }
  
  // è·å–ç¼“å­˜
  get(key) {
    const entry = this.cache.get(key);
    if (!entry) return null;
    
    if (Date.now() - entry.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }
    
    return entry.data;
  }
  
  // è®¾ç½®ç¼“å­˜
  set(key, data) {
    // LRUç­–ç•¥
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    
    this.cache.set(key, {
      data: data,
      timestamp: Date.now()
    });
  }
}
```

### 5. é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

#### 5.1 æ‹¼éŸ³æœç´¢æ”¯æŒ
```javascript
class PinyinMatcher {
  constructor() {
    // åŠ è½½æ‹¼éŸ³åº“
    this.pinyinLib = require('pinyin-lib');
  }
  
  // æ‹¼éŸ³åŒ¹é…
  match(keyword, text) {
    // è·å–æ–‡æœ¬çš„æ‹¼éŸ³
    const textPinyin = this.pinyinLib.getPinyin(text);
    const textInitials = this.pinyinLib.getInitials(text);
    
    // å…¨æ‹¼åŒ¹é…
    if (textPinyin.includes(keyword)) {
      return { match: true, type: 'pinyin', score: 70 };
    }
    
    // é¦–å­—æ¯åŒ¹é…
    if (textInitials.includes(keyword.toUpperCase())) {
      return { match: true, type: 'initials', score: 60 };
    }
    
    return { match: false };
  }
}
```

#### 5.2 æœç´¢åˆ†æä¸å­¦ä¹ 
```javascript
class SearchAnalytics {
  // è®°å½•æœç´¢è¡Œä¸º
  recordSearch(keyword, selectedSuggestion, results) {
    const record = {
      keyword: keyword,
      suggestion: selectedSuggestion,
      resultCount: results.length,
      timestamp: Date.now(),
      userId: this.getUserId()
    };
    
    // ä¿å­˜åˆ°æœ¬åœ°
    this.saveToLocal(record);
    
    // å¼‚æ­¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆç”¨äºåˆ†æï¼‰
    this.uploadToServer(record);
  }
  
  // è·å–ä¸ªæ€§åŒ–æ¨è
  getPersonalizedSuggestions() {
    const history = this.getSearchHistory();
    const frequency = this.calculateFrequency(history);
    
    return Object.entries(frequency)
      .sort((a, b) => b[1] - a[1])
      .slice(0, 5)
      .map(([keyword, count]) => ({
        keyword: keyword,
        count: count,
        type: 'personal'
      }));
  }
}
```

## ğŸ”Œ ä¸ç°æœ‰ä»£ç é›†æˆæ–¹æ¡ˆ

### å½“å‰æœç´¢å®ç°åˆ†æ
åŸºäºå¯¹ `miniprogram/pages/ticket-list/` çš„åˆ†æï¼Œå½“å‰æœç´¢å®ç°ï¼š
- **æœç´¢æ¡†**ï¼šä½¿ç”¨ TDesign çš„ `t-search` ç»„ä»¶
- **æœç´¢è§¦å‘**ï¼š`onSearchChange` å’Œ `onSearch` æ–¹æ³•
- **æœç´¢å­—æ®µ**ï¼šä»…æ”¯æŒå·¥å•å·ã€æ ‡é¢˜ã€æäº¤äºº
- **å®ç°æ–¹å¼**ï¼šæ•°æ®åº“æ­£åˆ™è¡¨è¾¾å¼æŸ¥è¯¢

### é›†æˆæ­¥éª¤

#### æ­¥éª¤ 1ï¼šä¿®æ”¹é¡µé¢æ•°æ®ç»“æ„
```javascript
// pages/ticket-list/index.js
data: {
  // æ–°å¢æœç´¢ç›¸å…³æ•°æ®
  searchManager: null,          // æœç´¢ç®¡ç†å™¨å®ä¾‹
  searchExecutor: null,         // æœç´¢æ‰§è¡Œå™¨å®ä¾‹
  showSuggestions: false,       // æ˜¯å¦æ˜¾ç¤ºæœç´¢å»ºè®®
  searchSuggestions: {          // æœç´¢å»ºè®®æ•°æ®
    exact: [],
    partial: [],
    fuzzy: []
  },
  searchMode: 'hybrid',         // æœç´¢æ¨¡å¼ï¼šhybrid/database/local
  localTicketCache: [],         // æœ¬åœ°å·¥å•ç¼“å­˜
  // ... ç°æœ‰æ•°æ®
}
```

#### æ­¥éª¤ 2ï¼šåˆå§‹åŒ–æœç´¢ç®¡ç†å™¨
```javascript
// åœ¨ onLoad æ–¹æ³•ä¸­
onLoad(options) {
  // ... ç°æœ‰ä»£ç 
  
  // åˆå§‹åŒ–æœç´¢ç®¡ç†å™¨
  const SearchManager = require('../../utils/search-manager');
  const SearchExecutor = require('../../utils/search-executor');
  
  this.data.searchManager = new SearchManager();
  this.data.searchExecutor = new SearchExecutor(this.data.searchManager);
  
  // åŠ è½½å·¥å•åˆ—è¡¨æ—¶æ„å»ºç´¢å¼•
  this.loadTicketList();
}
```

#### æ­¥éª¤ 3ï¼šæ”¹é€ æœç´¢æ–¹æ³•
```javascript
// æ”¹é€  onSearchChange æ–¹æ³•
onSearchChange(e) {
  const keyword = e.detail.value;
  this.setData({ searchKeyword: keyword });
  
  // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
  if (this.searchTimer) {
    clearTimeout(this.searchTimer);
  }
  
  // é˜²æŠ–å¤„ç†
  if (keyword.length >= 1) {
    this.searchTimer = setTimeout(() => {
      this.executeHybridSearch(keyword);
    }, 300);
  } else if (keyword.length === 0) {
    // æ¸…ç©ºæœç´¢
    this.setData({ 
      showSuggestions: false,
      searchSuggestions: { exact: [], partial: [], fuzzy: [] }
    });
    this.loadTicketList();
  }
}

// æ–°å¢æ··åˆæœç´¢æ–¹æ³•
async executeHybridSearch(keyword) {
  // åˆ¤æ–­æ˜¯å¦ä¸ºå·¥å•å·
  if (/^TK\d{11,}$/i.test(keyword)) {
    // å·¥å•å·ç²¾ç¡®æŸ¥è¯¢
    await this.searchByTicketNo(keyword);
  } else {
    // ä½¿ç”¨ Fuse.js æœ¬åœ°æœç´¢
    const results = await this.data.searchExecutor.execute(keyword);
    
    if (results.type === 'fuzzy' || results.type === 'mixed') {
      // æ˜¾ç¤ºæœç´¢ç»“æœ
      this.setData({
        ticketList: results.results,
        showSuggestions: true,
        searchSuggestions: results.suggestions
      });
    }
  }
}
```

## ğŸ“Š å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®ç°ï¼ˆ2å¤©ï¼‰
| ä»»åŠ¡ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| å®‰è£…é…ç½® Fuse.js | 2h | NPMå®‰è£…ï¼Œæ„å»ºé…ç½® |
| å®ç°æœç´¢ç®¡ç†å™¨ | 4h | SearchManagerç±»å¼€å‘ |
| å®ç°æœç´¢æ‰§è¡Œå™¨ | 3h | SearchExecutorç±»å¼€å‘ |
| æ”¹é€ ç°æœ‰æœç´¢é€»è¾‘ | 3h | é›†æˆåˆ°ticket-listé¡µé¢ |
| åŸºç¡€æµ‹è¯• | 4h | åŠŸèƒ½éªŒè¯ |

### ç¬¬äºŒé˜¶æ®µï¼šUIä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
| ä»»åŠ¡ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| æœç´¢å»ºè®®UI | 3h | ä¸‹æ‹‰å»ºè®®é¢æ¿ |
| ç»“æœé«˜äº® | 2h | å…³é”®è¯é«˜äº®æ˜¾ç¤º |
| æœç´¢å†å² | 2h | æœ¬åœ°å­˜å‚¨ç®¡ç† |
| å¿«æ·æ ‡ç­¾ | 1h | å¸¸ç”¨æœç´¢æ ‡ç­¾ |

### ç¬¬ä¸‰é˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–ï¼ˆ1å¤©ï¼‰
| ä»»åŠ¡ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| å¢é‡ç´¢å¼• | 3h | å®æ—¶æ›´æ–°ç´¢å¼• |
| ç»“æœç¼“å­˜ | 2h | LRUç¼“å­˜ç­–ç•¥ |
| æ‰¹é‡å¤„ç† | 2h | åˆ†é¡µåŠ è½½ä¼˜åŒ– |
| æ€§èƒ½ç›‘æ§ | 1h | æ·»åŠ æ€§èƒ½æ—¥å¿— |

### ç¬¬å››é˜¶æ®µï¼šé«˜çº§ç‰¹æ€§ï¼ˆå¯é€‰ï¼Œ2å¤©ï¼‰
| ä»»åŠ¡ | æ—¶é—´ | è¯´æ˜ |
|------|------|------|
| æ‹¼éŸ³æœç´¢ | 6h | ä¸­æ–‡æ‹¼éŸ³æ”¯æŒ |
| ç»„åˆç­›é€‰ | 4h | å¤šæ¡ä»¶ç»„åˆæœç´¢ |
| æœç´¢åˆ†æ | 3h | ç”¨æˆ·è¡Œä¸ºç»Ÿè®¡ |
| ä¸ªæ€§åŒ–æ¨è | 3h | åŸºäºå†å²çš„æ¨è |

**æ ¸å¿ƒåŠŸèƒ½æ€»è®¡ï¼š4å¤©**
- åŸºç¡€å®ç°ï¼š2å¤©
- UIä¼˜åŒ–ï¼š1å¤©
- æ€§èƒ½ä¼˜åŒ–ï¼š1å¤©

**å®Œæ•´åŠŸèƒ½æ€»è®¡ï¼š6å¤©**
- æ ¸å¿ƒåŠŸèƒ½ï¼š4å¤©
- é«˜çº§ç‰¹æ€§ï¼š2å¤©

### é‡Œç¨‹ç¢‘
1. **M1**ï¼ˆç¬¬2å¤©ï¼‰ï¼šFuse.jsé›†æˆå®Œæˆï¼Œæ··åˆæœç´¢å¯ç”¨
2. **M2**ï¼ˆç¬¬3å¤©ï¼‰ï¼šæœç´¢å»ºè®®UIå®Œæ•´ï¼Œç”¨æˆ·ä½“éªŒä¼˜åŒ–
3. **M3**ï¼ˆç¬¬4å¤©ï¼‰ï¼šæ€§èƒ½ä¼˜åŒ–å®Œæˆï¼Œè¾¾åˆ°ç›®æ ‡æŒ‡æ ‡
4. **M4**ï¼ˆç¬¬6å¤©ï¼‰ï¼šé«˜çº§åŠŸèƒ½å®Œæˆï¼ˆå¯é€‰ï¼‰

## ğŸ¯ æˆåŠŸæŒ‡æ ‡

### æ€§èƒ½æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|------|--------|----------|
| å·¥å•å·æœç´¢å“åº”æ—¶é—´ | <100ms | æ€§èƒ½æµ‹è¯• |
| æç¤ºè¯ç”Ÿæˆæ—¶é—´ | <50ms | å•å…ƒæµ‹è¯• |
| ç´¢å¼•æ›´æ–°æ—¶é—´ | <200ms | æ€§èƒ½æµ‹è¯• |
| å†…å­˜å ç”¨ | <10MB | å†…å­˜åˆ†æ |

### ä¸šåŠ¡æŒ‡æ ‡
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | è¯„ä¼°æ–¹æ³• |
|------|--------|----------|
| æœç´¢æˆåŠŸç‡ | >95% | ç”¨æˆ·åé¦ˆ |
| æ•°æ®åº“æŸ¥è¯¢å‡å°‘ | >90% | æ—¥å¿—åˆ†æ |
| ç”¨æˆ·æ»¡æ„åº¦ | >4.5/5 | é—®å·è°ƒæŸ¥ |
| æˆæœ¬èŠ‚çœ | >80% | è´¹ç”¨ç»Ÿè®¡ |

## âš ï¸ é£é™©ä¸å¯¹ç­–

### æŠ€æœ¯é£é™©
| é£é™© | å½±å“ | å¯¹ç­– |
|------|------|------|
| ç´¢å¼•å ç”¨å†…å­˜è¿‡å¤§ | åº”ç”¨å´©æºƒ | å®ç°ç´¢å¼•åˆ†ç‰‡å’Œå‹ç¼© |
| æç¤ºè¯ç”Ÿæˆæ…¢ | ç”¨æˆ·ä½“éªŒå·® | ä¼˜åŒ–ç®—æ³•ï¼Œæ·»åŠ ç¼“å­˜ |
| å·¥å•å·æ ¼å¼å˜åŒ– | æœç´¢å¤±æ•ˆ | å¯é…ç½®çš„æ ¼å¼åŒ¹é… |

### ä¸šåŠ¡é£é™©
| é£é™© | å½±å“ | å¯¹ç­– |
|------|------|------|
| ç”¨æˆ·ä¸é€‚åº”æ–°æœç´¢ | ä½¿ç”¨ç‡ä½ | æä¾›æ–°æ‰‹å¼•å¯¼ |
| æç¤ºè¯ä¸å‡†ç¡® | æœç´¢å¤±è´¥ | æ”¶é›†åé¦ˆæŒç»­ä¼˜åŒ– |

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¾®ä¿¡å°ç¨‹åºæœç´¢ç»„ä»¶æ–‡æ¡£](https://developers.weixin.qq.com/miniprogram/dev/component/input.html)
- [æ•°æ®åº“ç´¢å¼•æœ€ä½³å®è·µ](https://developers.weixin.qq.com/miniprogram/dev/wxcloud/guide/database/index.html)
- [å‰ç«¯æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://developers.weixin.qq.com/miniprogram/dev/framework/performance/)

## ğŸ”„ åç»­ä¼˜åŒ–æ–¹å‘

1. **æ™ºèƒ½æ’åº**ï¼šåŸºäºç”¨æˆ·è¡Œä¸ºçš„æœç´¢ç»“æœæ’åº
2. **è¯­éŸ³æœç´¢**ï¼šæ”¯æŒè¯­éŸ³è¾“å…¥æœç´¢
3. **å›¾åƒæœç´¢**ï¼šæ”¯æŒæ‹ç…§è¯†åˆ«è®¾å¤‡æœç´¢ç›¸å…³å·¥å•
4. **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒä¸­è‹±æ–‡æ··åˆæœç´¢
5. **è”æƒ³è¾“å…¥**ï¼šåŸºäºä¸Šä¸‹æ–‡çš„æ™ºèƒ½è”æƒ³

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼š3.0*
*åˆ›å»ºæ—¶é—´ï¼š2025-08-18*
*æ›´æ–°æ—¶é—´ï¼š2025-08-18*
*ä½œè€…ï¼šAI Assistant*
*çŠ¶æ€ï¼šå®Œæˆè§„åˆ’ï¼Œå¾…å®æ–½*

## é™„å½•

### A. æœç´¢é…ç½®å‚æ•°
```javascript
// config/search.config.js
module.exports = {
  // æœç´¢åŸºç¡€é…ç½®
  search: {
    minKeywordLength: 1,        // æœ€å°æœç´¢é•¿åº¦
    maxSuggestions: 20,          // æœ€å¤§æç¤ºè¯æ•°é‡
    debounceDelay: 300,          // é˜²æŠ–å»¶è¿Ÿ(ms)
    cacheExpiry: 60000,          // ç¼“å­˜è¿‡æœŸæ—¶é—´(ms)
    maxHistoryItems: 10          // æœ€å¤§å†å²è®°å½•æ•°
  },
  
  // å·¥å•å·æ ¼å¼
  ticketFormat: {
    pattern: /^TK\d{11,}$/i,    // å·¥å•å·æ­£åˆ™
    prefix: 'TK',                // å·¥å•å·å‰ç¼€
    minLength: 13                // æœ€å°é•¿åº¦
  },
  
  // æç¤ºè¯æƒé‡
  suggestionWeights: {
    exact: 100,                  // å®Œå…¨åŒ¹é…
    startsWith: 80,              // å¼€å¤´åŒ¹é…
    contains: 60,                // åŒ…å«åŒ¹é…
    pinyin: 50,                  // æ‹¼éŸ³åŒ¹é…
    recent: 20                   // æœ€è¿‘ä½¿ç”¨åŠ åˆ†
  },
  
  // å¿«æ·æ ‡ç­¾
  quickTags: [
    'ç´§æ€¥',
    'ç½‘ç»œé—®é¢˜',
    'æ‰“å°æœº',
    'è½¯ä»¶å®‰è£…',
    'è´¦å·æƒé™',
    'ç¡¬ä»¶æ•…éšœ'
  ]
};
```

### B. æµ‹è¯•ç”¨ä¾‹ç¤ºä¾‹
```javascript
// test/search.test.js
describe('æœç´¢åŠŸèƒ½æµ‹è¯•', () => {
  // å·¥å•å·æœç´¢
  it('åº”è¯¥èƒ½ç²¾ç¡®æœç´¢å·¥å•å·', () => {
    const result = search.execute('TK20250816001');
    expect(result.type).toBe('exact');
    expect(result.results.length).toBe(1);
  });
  
  // æç¤ºè¯ç”Ÿæˆ
  it('åº”è¯¥ç”Ÿæˆæ­£ç¡®çš„æç¤ºè¯', () => {
    const suggestions = search.generateSuggestions('è…¾');
    expect(suggestions.partial).toContain('è…¾è®¯');
  });
  
  // æ€§èƒ½æµ‹è¯•
  it('æç¤ºè¯ç”Ÿæˆåº”åœ¨50mså†…å®Œæˆ', () => {
    const start = Date.now();
    search.generateSuggestions('ç½‘ç»œ');
    const duration = Date.now() - start;
    expect(duration).toBeLessThan(50);
  });
});
```