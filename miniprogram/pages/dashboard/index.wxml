<!-- å·¥ç¨‹å¸ˆå·¥ä½œå°é¡µé¢ -->
<view class="dashboard-container">
  <!-- çŠ¶æ€æ  -->
  <view class="gradient-bg status-header">
    <view class="status-content">
      <view class="engineer-info">
        <!-- å¤´åƒé€‰æ‹©æŒ‰é’® -->
        <button 
          class="avatar-button" 
          open-type="chooseAvatar" 
          bindchooseavatar="onChooseAvatar"
        >
          <view class="avatar-wrapper">
            <image 
              class="engineer-avatar" 
              src="{{engineerInfo.avatar || '/assets/default-avatar.png'}}"
              mode="aspectFill"
            />
            <view class="avatar-edit-overlay">
              <image class="camera-icon" src="/assets/icons/system/camera.png" mode="aspectFit" />
            </view>
          </view>
        </button>
        <view class="engineer-details">
          <view class="engineer-name">
            <text>{{engineerInfo.name || 'å·¥ç¨‹å¸ˆ'}}</text>
          </view>
          <view class="workload">
            å·¥ä½œé‡: {{engineerInfo.currentTasks}}/{{engineerInfo.maxTasks}}
          </view>
        </view>
      </view>
      <view class="location-info">
        <view class="location">ğŸ“ {{engineerInfo.location || 'æœªè®¾ç½®'}}</view>
        <view class="last-update">æœ€åæ›´æ–°: {{lastUpdateTime}}</view>
      </view>
    </view>
  </view>

  <!-- ä»Šæ—¥å·¥ä½œæ¦‚è§ˆ -->
  <view class="section-container">
    <view class="section-title">ä»Šæ—¥å·¥ä½œæ¦‚è§ˆ</view>
    <view class="today-stats-grid">
      <view 
        class="stat-card" 
        wx:for="{{todayStats}}" 
        wx:key="key"
        bindtap="onStatClick"
        data-type="{{item.key}}"
      >
        <view class="stat-icon-wrapper">
          <image 
            src="{{item.icon}}" 
            mode="aspectFit"
            class="stat-icon"
          />
        </view>
        <view class="stat-value {{item.colorClass}}">{{item.value}}</view>
        <text class="stat-label">{{item.label}}</text>
      </view>
    </view>
  </view>

  <!-- ç´§æ€¥å·¥å•æé†’ -->
  <view class="section-container" wx:if="{{urgentTickets.length > 0}}">
    <t-notice-bar 
      visible="{{true}}"
      theme="error"
      prefix-icon="error-circle"
      content="æ‚¨æœ‰ {{urgentTickets.length}} ä¸ªç´§æ€¥å·¥å•éœ€è¦å¤„ç†"
      bind:click="navigateToUrgentTickets"
    />
  </view>

  <!-- å¿«æ·æ“ä½œ -->
  <view class="section-container">
    <view class="section-title">å¿«æ·æ“ä½œ</view>
    <view class="quick-actions-grid">
      <view 
        class="quick-action-item" 
        wx:for="{{quickActions}}" 
        wx:key="key"
        bindtap="onQuickAction"
        data-action="{{item.key}}"
      >
        <view class="quick-action-icon">
          <image 
            src="{{item.imageIcon}}" 
            mode="aspectFit"
            class="action-image-icon"
          />
        </view>
        <text class="quick-action-text">{{item.title}}</text>
      </view>
    </view>
  </view>

  <!-- å¾…å¤„ç†å·¥å• -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">å¾…å¤„ç†å·¥å•</text>
      <text class="section-more" bindtap="navigateToTicketList">æŸ¥çœ‹å…¨éƒ¨ ></text>
    </view>
    
    <view class="ticket-list" wx:if="{{latestTickets.length > 0}}">
      <view 
        class="ticket-card {{item.isPool ? 'pool-ticket' : ''}} {{item.isMine ? 'my-ticket' : ''}}" 
        wx:for="{{latestTickets}}" 
        wx:key="id"
      >
        <!-- å¯ç‚¹å‡»åŒºåŸŸ - åªåŒ…å«å¤´éƒ¨å’Œå†…å®¹ -->
        <view class="ticket-clickable" bindtap="navigateToTicketDetail" data-id="{{item.id}}">
          <view class="ticket-header">
            <view class="ticket-left">
              <view class="priority-dot priority-{{item.priority}}"></view>
              <text class="ticket-no">#{{item.ticketNo}}</text>
            </view>
            <view class="ticket-right">
              <t-tag 
                theme="{{getStatusTheme(item.status)}}"
                variant="light"
                size="small"
              >
                {{statusText[item.status]}}
              </t-tag>
              <t-tag 
                wx:if="{{item.priority === 'urgent'}}"
                theme="danger"
                variant="light"
                size="small"
              >
                ç´§æ€¥
              </t-tag>
            </view>
          </view>
          
          <view class="ticket-content">
            <view class="content-header">
              <text class="ticket-title">{{item.title}}</text>
              <view class="assignee-tag" wx:if="{{item.assigneeName}}">
                <image class="assignee-icon" src="/assets/icons/engineer.png" mode="aspectFit"/>
                <text class="assignee-text">{{item.assigneeName}}</text>
              </view>
            </view>
            <view class="ticket-category">
              <image class="category-icon" src="/assets/icons/category.png" mode="aspectFit"/>
              <text class="category-text">{{item.category}}</text>
            </view>
          </view>
          
          <!-- å·¥å•ä¿¡æ¯ - 2åˆ—å¸ƒå±€ -->
          <view class="ticket-info">
            <view class="info-row">
              <view class="info-item" wx:if="{{item.company}}">
                <image class="info-icon" src="/assets/icons/company.png" mode="aspectFit"/>
                <text class="info-text">{{item.company}}</text>
              </view>
              <view class="info-item">
                <image class="info-icon" src="/assets/icons/location.png" mode="aspectFit"/>
                <text class="info-text">{{item.location}}</text>
              </view>
            </view>
            <view class="info-row">
              <view class="info-item">
                <image class="info-icon" src="/assets/icons/user.png" mode="aspectFit"/>
                <text class="info-text">{{item.submitter}}</text>
              </view>
              <view class="info-item">
                <image class="info-icon" src="/assets/icons/time.png" mode="aspectFit"/>
                <text class="info-text">{{item.createTimeDisplay}}</text>
              </view>
            </view>
          </view>
        </view>
        <!-- ç»“æŸå¯ç‚¹å‡»åŒºåŸŸ -->
        
        <!-- æ“ä½œæŒ‰é’®ç‹¬ç«‹åŒºåŸŸ - ä¸è§¦å‘è·³è½¬ -->
        <view class="ticket-actions">
          <!-- åªæœ‰å·¥ç¨‹å¸ˆå’Œç»ç†æ˜¾ç¤º"å¼€å§‹å¤„ç†"æŒ‰é’® -->
          <button 
            wx:if="{{(isEngineer || isManager) && item.status === 'pending' && !item.assigneeOpenid}}"
            class="custom-action-btn btn-primary-action"
            catchtap="acceptTicket"
            data-id="{{item.id}}"
          >
            å¼€å§‹å¤„ç†
          </button>
          <!-- æ™®é€šç”¨æˆ·çš„å¾…å¤„ç†å·¥å•æ˜¾ç¤ºæŸ¥çœ‹æŒ‰é’® -->
          <button 
            wx:elif="{{!isEngineer && !isManager && item.status === 'pending'}}"
            class="custom-action-btn btn-view-detail"
            catchtap="viewDetail"
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹çŠ¶æ€
          </button>
          <button 
            wx:elif="{{item.status === 'processing'}}"
            class="custom-action-btn btn-view-detail"
            catchtap="viewDetail"
            data-id="{{item.id}}"
          >
            æŸ¥çœ‹è¯¦æƒ…
          </button>
          <button 
            wx:elif="{{item.status === 'resolved'}}"
            class="custom-action-btn btn-success"
            catchtap="viewDetail"
            data-id="{{item.id}}"
          >
            å·²å®Œæˆ
          </button>
        </view>
      </view>
    </view>
    
    <!-- æ²¡æœ‰å¾…å¤„ç†å·¥å•æ—¶çš„æç¤º -->
    <view wx:else class="no-tickets-hint">
      <view class="hint-icon">âœ…</view>
      <text class="hint-text">æ‰€æœ‰ä»»åŠ¡æ­£åœ¨æœ‰åºå¤„ç†ä¸­</text>
    </view>
  </view>

</view>