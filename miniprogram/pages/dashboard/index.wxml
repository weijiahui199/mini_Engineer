<!-- 工程师工作台页面 -->
<view class="dashboard-container">
  <!-- 状态栏 -->
  <view class="gradient-bg status-header">
    <view class="status-content">
      <view class="engineer-info">
        <t-avatar 
          size="large" 
          image="{{engineerInfo.avatar}}"
          icon="user"
        />
        <view class="engineer-details">
          <view class="engineer-name">
            <text>{{engineerInfo.name || '工程师'}}</text>
            <view class="status-indicator {{engineerInfo.status}}"></view>
            <text class="status-text">{{statusText[engineerInfo.status]}}</text>
          </view>
          <view class="workload">
            工作量: {{engineerInfo.currentTasks}}/{{engineerInfo.maxTasks}}
          </view>
        </view>
      </view>
      <view class="location-info">
        <view class="location">📍 {{engineerInfo.location || '未设置'}}</view>
        <view class="last-update">最后更新: {{lastUpdateTime}}</view>
      </view>
    </view>
  </view>

  <!-- 今日工作概览 -->
  <view class="section-container">
    <view class="section-title">今日工作概览</view>
    <t-grid column="{{4}}" border="{{false}}">
      <t-grid-item 
        wx:for="{{todayStats}}" 
        wx:key="key"
        text="{{item.label}}"
        description=""
        bind:click="onStatClick"
        data-type="{{item.key}}"
      >
        <view slot="image" class="stat-item">
          <view class="stat-value {{item.colorClass}}">{{item.value}}</view>
        </view>
      </t-grid-item>
    </t-grid>
  </view>

  <!-- 紧急工单提醒 -->
  <view class="section-container" wx:if="{{urgentTickets.length > 0}}">
    <t-notice-bar 
      visible="{{true}}"
      theme="error"
      prefix-icon="error-circle"
      content="您有 {{urgentTickets.length}} 个紧急工单需要处理"
      bind:click="navigateToUrgentTickets"
    />
  </view>

  <!-- 快捷操作 -->
  <view class="section-container">
    <view class="section-title">快捷操作</view>
    <t-grid column="{{2}}" border="{{false}}" align="center">
      <t-grid-item 
        wx:for="{{quickActions}}" 
        wx:key="key"
        text="{{item.title}}"
        bind:click="onQuickAction"
        data-action="{{item.key}}"
      >
        <view slot="image" class="quick-action-icon">
          <text class="emoji-icon">{{item.icon}}</text>
        </view>
      </t-grid-item>
    </t-grid>
  </view>

  <!-- 最新工单 -->
  <view class="section-container">
    <view class="section-header">
      <text class="section-title">最新工单</text>
      <text class="section-more" bindtap="navigateToTicketList">查看全部 ></text>
    </view>
    
    <view class="ticket-list" wx:if="{{latestTickets.length > 0}}">
      <view 
        class="ticket-card" 
        wx:for="{{latestTickets}}" 
        wx:key="id"
        bindtap="navigateToTicketDetail"
        data-id="{{item.id}}"
      >
        <view class="ticket-header">
          <view class="ticket-left">
            <view class="priority-dot priority-{{item.priority}}"></view>
            <text class="ticket-no">{{item.ticketNo}}</text>
            <t-tag 
              wx:if="{{item.priority === 'urgent'}}"
              theme="danger"
              variant="light"
              size="small"
            >
              紧急
            </t-tag>
          </view>
          <view class="ticket-status">
            <t-tag 
              theme="{{getStatusTheme(item.status)}}"
              variant="light"
              size="small"
            >
              {{statusText[item.status]}}
            </t-tag>
          </view>
        </view>
        
        <view class="ticket-content">
          <text class="ticket-title">{{item.title}}</text>
          <view class="ticket-meta">
            <view class="meta-item">
              <text class="meta-icon">👤</text>
              <text class="meta-text">{{item.submitter}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">📍</text>
              <text class="meta-text">{{item.location}}</text>
            </view>
            <view class="meta-item">
              <text class="meta-icon">⏰</text>
              <text class="meta-text">{{item.createTime}}</text>
            </view>
          </view>
        </view>
        
        <view class="ticket-actions">
          <t-button 
            wx:if="{{item.status === 'pending'}}"
            theme="primary"
            size="small"
            bind:click="startProcessing"
            data-id="{{item.id}}"
          >
            开始处理
          </t-button>
          <t-button 
            wx:elif="{{item.status === 'processing'}}"
            theme="default"
            size="small"
            bind:click="viewDetail"
            data-id="{{item.id}}"
          >
            查看详情
          </t-button>
        </view>
      </view>
    </view>
    
    <t-empty 
      wx:else
      icon="inbox"
      description="暂无新工单"
    />
  </view>

  <!-- 工作状态切换 -->
  <t-popup 
    visible="{{statusPopupVisible}}" 
    placement="bottom"
    bind:visible-change="handleStatusPopupChange"
  >
    <view class="status-popup">
      <view class="popup-header">
        <text class="popup-title">切换工作状态</text>
        <t-icon name="close" size="48rpx" bindtap="closeStatusPopup" />
      </view>
      <t-radio-group 
        value="{{engineerInfo.status}}"
        bind:change="onStatusChange"
      >
        <t-radio 
          wx:for="{{statusOptions}}" 
          wx:key="value"
          label="{{item.label}}"
          value="{{item.value}}"
          icon="circle"
        />
      </t-radio-group>
    </view>
  </t-popup>
</view>